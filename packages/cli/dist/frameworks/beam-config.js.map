{"version":3,"sources":["../../src/frameworks/beam-config.ts"],"sourcesContent":["/**\n * Beam Configuration Loader\n *\n * Loads Beam configuration from multiple sources:\n * 1. beam.config.js / beam.config.mjs\n * 2. package.json \"beam\" field\n * 3. Environment variables\n * 4. Options passed to the integration\n */\n\nimport { readFileSync, existsSync } from \"fs\";\nimport { join } from \"path\";\nimport { pathToFileURL } from \"url\";\n\nexport interface BeamIntegrationConfig {\n  /** Enable/disable Beam (default: true) */\n  enabled?: boolean;\n\n  /** Port to tunnel (auto-detected if not specified) */\n  port?: number;\n\n  /** Use a reserved subdomain */\n  subdomain?: string;\n\n  /** Enable request inspector */\n  inspect?: boolean;\n\n  /** Basic auth (user:pass) */\n  auth?: string;\n\n  /** Auto-copy tunnel URL to clipboard */\n  copyToClipboard?: boolean;\n\n  /** Show QR code in terminal */\n  qr?: boolean;\n\n  /** Webhook capture mode */\n  webhook?: boolean;\n\n  /** Tunnel name */\n  name?: string;\n}\n\n/**\n * Load Beam configuration from all sources\n */\nexport function loadBeamConfig(options?: BeamIntegrationConfig): BeamIntegrationConfig {\n  const projectPath = process.cwd();\n\n  // Start with defaults\n  let config: BeamIntegrationConfig = {\n    enabled: true,\n    inspect: false,\n    copyToClipboard: false,\n    qr: false,\n    webhook: false,\n  };\n\n  // Load from beam.config.js if exists\n  const configFile = findConfigFile(projectPath);\n  if (configFile) {\n    try {\n      const fileConfig = loadConfigFile(configFile);\n      config = { ...config, ...fileConfig };\n    } catch (error) {\n      console.warn(\"Beam: Failed to load config file:\", error);\n    }\n  }\n\n  // Load from package.json \"beam\" field\n  const packageJsonPath = join(projectPath, \"package.json\");\n  if (existsSync(packageJsonPath)) {\n    try {\n      const packageJson = JSON.parse(readFileSync(packageJsonPath, \"utf-8\"));\n      if (packageJson.beam && typeof packageJson.beam === \"object\") {\n        config = { ...config, ...packageJson.beam };\n      }\n    } catch {\n      // Ignore package.json errors\n    }\n  }\n\n  // Load from environment variables\n  config = {\n    ...config,\n    ...loadEnvConfig(),\n  };\n\n  // Apply options passed to integration (highest priority)\n  if (options) {\n    config = { ...config, ...options };\n  }\n\n  return config;\n}\n\n/**\n * Find config file in project\n */\nfunction findConfigFile(projectPath: string): string | null {\n  const configFiles = [\n    \"beam.config.js\",\n    \"beam.config.mjs\",\n    \"beam.config.cjs\",\n    \"beam.config.ts\",\n  ];\n\n  for (const file of configFiles) {\n    const filePath = join(projectPath, file);\n    if (existsSync(filePath)) {\n      return filePath;\n    }\n  }\n\n  return null;\n}\n\n/**\n * Load config from file\n */\nfunction loadConfigFile(filePath: string): BeamIntegrationConfig {\n  // For .js and .mjs files, use dynamic import\n  if (filePath.endsWith(\".mjs\") || filePath.endsWith(\".js\")) {\n    // Use require for CommonJS compatibility\n    try {\n      // eslint-disable-next-line @typescript-eslint/no-var-requires\n      const config = require(filePath);\n      return config.default || config;\n    } catch {\n      // If require fails, it might be ESM - we'll handle this differently\n      return {};\n    }\n  }\n\n  // For other files, just return empty (TypeScript needs transpilation)\n  return {};\n}\n\n/**\n * Load config from environment variables\n */\nfunction loadEnvConfig(): Partial<BeamIntegrationConfig> {\n  const config: Partial<BeamIntegrationConfig> = {};\n\n  if (process.env.BEAM_DISABLED === \"true\") {\n    config.enabled = false;\n  }\n\n  if (process.env.BEAM_PORT) {\n    config.port = parseInt(process.env.BEAM_PORT, 10);\n  }\n\n  if (process.env.BEAM_SUBDOMAIN) {\n    config.subdomain = process.env.BEAM_SUBDOMAIN;\n  }\n\n  if (process.env.BEAM_INSPECT === \"true\") {\n    config.inspect = true;\n  }\n\n  if (process.env.BEAM_AUTH) {\n    config.auth = process.env.BEAM_AUTH;\n  }\n\n  if (process.env.BEAM_COPY === \"true\") {\n    config.copyToClipboard = true;\n  }\n\n  if (process.env.BEAM_QR === \"true\") {\n    config.qr = true;\n  }\n\n  if (process.env.BEAM_WEBHOOK === \"true\") {\n    config.webhook = true;\n  }\n\n  if (process.env.BEAM_NAME) {\n    config.name = process.env.BEAM_NAME;\n  }\n\n  return config;\n}\n"],"mappings":";;;;;;;;AAUA,SAAS,cAAc,kBAAkB;AACzC,SAAS,YAAY;AAmCd,SAAS,eAAe,SAAwD;AACrF,QAAM,cAAc,QAAQ,IAAI;AAGhC,MAAI,SAAgC;AAAA,IAClC,SAAS;AAAA,IACT,SAAS;AAAA,IACT,iBAAiB;AAAA,IACjB,IAAI;AAAA,IACJ,SAAS;AAAA,EACX;AAGA,QAAM,aAAa,eAAe,WAAW;AAC7C,MAAI,YAAY;AACd,QAAI;AACF,YAAM,aAAa,eAAe,UAAU;AAC5C,eAAS,EAAE,GAAG,QAAQ,GAAG,WAAW;AAAA,IACtC,SAAS,OAAO;AACd,cAAQ,KAAK,qCAAqC,KAAK;AAAA,IACzD;AAAA,EACF;AAGA,QAAM,kBAAkB,KAAK,aAAa,cAAc;AACxD,MAAI,WAAW,eAAe,GAAG;AAC/B,QAAI;AACF,YAAM,cAAc,KAAK,MAAM,aAAa,iBAAiB,OAAO,CAAC;AACrE,UAAI,YAAY,QAAQ,OAAO,YAAY,SAAS,UAAU;AAC5D,iBAAS,EAAE,GAAG,QAAQ,GAAG,YAAY,KAAK;AAAA,MAC5C;AAAA,IACF,QAAQ;AAAA,IAER;AAAA,EACF;AAGA,WAAS;AAAA,IACP,GAAG;AAAA,IACH,GAAG,cAAc;AAAA,EACnB;AAGA,MAAI,SAAS;AACX,aAAS,EAAE,GAAG,QAAQ,GAAG,QAAQ;AAAA,EACnC;AAEA,SAAO;AACT;AAKA,SAAS,eAAe,aAAoC;AAC1D,QAAM,cAAc;AAAA,IAClB;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,EACF;AAEA,aAAW,QAAQ,aAAa;AAC9B,UAAM,WAAW,KAAK,aAAa,IAAI;AACvC,QAAI,WAAW,QAAQ,GAAG;AACxB,aAAO;AAAA,IACT;AAAA,EACF;AAEA,SAAO;AACT;AAKA,SAAS,eAAe,UAAyC;AAE/D,MAAI,SAAS,SAAS,MAAM,KAAK,SAAS,SAAS,KAAK,GAAG;AAEzD,QAAI;AAEF,YAAM,SAAS,UAAQ,QAAQ;AAC/B,aAAO,OAAO,WAAW;AAAA,IAC3B,QAAQ;AAEN,aAAO,CAAC;AAAA,IACV;AAAA,EACF;AAGA,SAAO,CAAC;AACV;AAKA,SAAS,gBAAgD;AACvD,QAAM,SAAyC,CAAC;AAEhD,MAAI,QAAQ,IAAI,kBAAkB,QAAQ;AACxC,WAAO,UAAU;AAAA,EACnB;AAEA,MAAI,QAAQ,IAAI,WAAW;AACzB,WAAO,OAAO,SAAS,QAAQ,IAAI,WAAW,EAAE;AAAA,EAClD;AAEA,MAAI,QAAQ,IAAI,gBAAgB;AAC9B,WAAO,YAAY,QAAQ,IAAI;AAAA,EACjC;AAEA,MAAI,QAAQ,IAAI,iBAAiB,QAAQ;AACvC,WAAO,UAAU;AAAA,EACnB;AAEA,MAAI,QAAQ,IAAI,WAAW;AACzB,WAAO,OAAO,QAAQ,IAAI;AAAA,EAC5B;AAEA,MAAI,QAAQ,IAAI,cAAc,QAAQ;AACpC,WAAO,kBAAkB;AAAA,EAC3B;AAEA,MAAI,QAAQ,IAAI,YAAY,QAAQ;AAClC,WAAO,KAAK;AAAA,EACd;AAEA,MAAI,QAAQ,IAAI,iBAAiB,QAAQ;AACvC,WAAO,UAAU;AAAA,EACnB;AAEA,MAAI,QAAQ,IAAI,WAAW;AACzB,WAAO,OAAO,QAAQ,IAAI;AAAA,EAC5B;AAEA,SAAO;AACT;","names":[]}