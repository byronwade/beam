{"version":3,"sources":["../src/frameworks/index.ts","../src/auto-setup.ts"],"sourcesContent":["/**\n * Framework Detection and Auto-Integration\n *\n * Detects the user's framework from package.json and provides\n * the appropriate integration method.\n */\n\nimport { readFileSync, existsSync } from \"fs\";\nimport { join } from \"path\";\n\nexport type FrameworkType = \"nextjs\" | \"vite\" | \"remix\" | \"astro\" | \"nuxt\" | \"sveltekit\" | \"unknown\";\n\nexport interface FrameworkInfo {\n  type: FrameworkType;\n  name: string;\n  version?: string;\n  configFile?: string;\n  devCommand: string;\n  defaultPort: number;\n  integrationMethod: \"wrapper\" | \"plugin\" | \"integration\" | \"generic\";\n}\n\ninterface PackageJson {\n  name?: string;\n  dependencies?: Record<string, string>;\n  devDependencies?: Record<string, string>;\n  scripts?: Record<string, string>;\n}\n\n/**\n * Detect the framework used in a project\n */\nexport function detectFramework(projectPath: string = process.cwd()): FrameworkInfo {\n  const packageJsonPath = join(projectPath, \"package.json\");\n\n  if (!existsSync(packageJsonPath)) {\n    return {\n      type: \"unknown\",\n      name: \"Unknown\",\n      devCommand: \"npm run dev\",\n      defaultPort: 3000,\n      integrationMethod: \"generic\",\n    };\n  }\n\n  try {\n    const packageJson: PackageJson = JSON.parse(readFileSync(packageJsonPath, \"utf-8\"));\n    const allDeps = {\n      ...packageJson.dependencies,\n      ...packageJson.devDependencies,\n    };\n\n    // Next.js detection\n    if (allDeps[\"next\"]) {\n      const nextConfigFiles = [\"next.config.js\", \"next.config.mjs\", \"next.config.ts\"];\n      const configFile = nextConfigFiles.find(f => existsSync(join(projectPath, f)));\n\n      return {\n        type: \"nextjs\",\n        name: \"Next.js\",\n        version: allDeps[\"next\"],\n        configFile,\n        devCommand: \"next dev\",\n        defaultPort: 3000,\n        integrationMethod: \"wrapper\",\n      };\n    }\n\n    // Remix detection (uses Vite)\n    if (allDeps[\"@remix-run/react\"] || allDeps[\"@remix-run/node\"]) {\n      const configFile = existsSync(join(projectPath, \"vite.config.ts\"))\n        ? \"vite.config.ts\"\n        : existsSync(join(projectPath, \"vite.config.js\"))\n          ? \"vite.config.js\"\n          : undefined;\n\n      return {\n        type: \"remix\",\n        name: \"Remix\",\n        version: allDeps[\"@remix-run/react\"] || allDeps[\"@remix-run/node\"],\n        configFile,\n        devCommand: \"remix vite:dev\",\n        defaultPort: 5173,\n        integrationMethod: \"plugin\",\n      };\n    }\n\n    // Astro detection\n    if (allDeps[\"astro\"]) {\n      const configFile = existsSync(join(projectPath, \"astro.config.mjs\"))\n        ? \"astro.config.mjs\"\n        : existsSync(join(projectPath, \"astro.config.ts\"))\n          ? \"astro.config.ts\"\n          : undefined;\n\n      return {\n        type: \"astro\",\n        name: \"Astro\",\n        version: allDeps[\"astro\"],\n        configFile,\n        devCommand: \"astro dev\",\n        defaultPort: 4321,\n        integrationMethod: \"integration\",\n      };\n    }\n\n    // Nuxt detection\n    if (allDeps[\"nuxt\"]) {\n      const configFile = existsSync(join(projectPath, \"nuxt.config.ts\"))\n        ? \"nuxt.config.ts\"\n        : existsSync(join(projectPath, \"nuxt.config.js\"))\n          ? \"nuxt.config.js\"\n          : undefined;\n\n      return {\n        type: \"nuxt\",\n        name: \"Nuxt\",\n        version: allDeps[\"nuxt\"],\n        configFile,\n        devCommand: \"nuxt dev\",\n        defaultPort: 3000,\n        integrationMethod: \"plugin\",\n      };\n    }\n\n    // SvelteKit detection\n    if (allDeps[\"@sveltejs/kit\"]) {\n      const configFile = existsSync(join(projectPath, \"vite.config.ts\"))\n        ? \"vite.config.ts\"\n        : existsSync(join(projectPath, \"vite.config.js\"))\n          ? \"vite.config.js\"\n          : undefined;\n\n      return {\n        type: \"sveltekit\",\n        name: \"SvelteKit\",\n        version: allDeps[\"@sveltejs/kit\"],\n        configFile,\n        devCommand: \"vite dev\",\n        defaultPort: 5173,\n        integrationMethod: \"plugin\",\n      };\n    }\n\n    // Generic Vite detection (check last as many frameworks use Vite)\n    if (allDeps[\"vite\"]) {\n      const configFile = existsSync(join(projectPath, \"vite.config.ts\"))\n        ? \"vite.config.ts\"\n        : existsSync(join(projectPath, \"vite.config.js\"))\n          ? \"vite.config.js\"\n          : undefined;\n\n      return {\n        type: \"vite\",\n        name: \"Vite\",\n        version: allDeps[\"vite\"],\n        configFile,\n        devCommand: \"vite\",\n        defaultPort: 5173,\n        integrationMethod: \"plugin\",\n      };\n    }\n\n    // Unknown framework\n    return {\n      type: \"unknown\",\n      name: \"Unknown\",\n      devCommand: \"npm run dev\",\n      defaultPort: 3000,\n      integrationMethod: \"generic\",\n    };\n  } catch {\n    return {\n      type: \"unknown\",\n      name: \"Unknown\",\n      devCommand: \"npm run dev\",\n      defaultPort: 3000,\n      integrationMethod: \"generic\",\n    };\n  }\n}\n\n/**\n * Get setup instructions for a framework\n */\nexport function getSetupInstructions(framework: FrameworkInfo): string {\n  switch (framework.type) {\n    case \"nextjs\":\n      return `\nAdd Beam to your next.config.js:\n\n  const withBeam = require('@byronwade/beam/next');\n  module.exports = withBeam({\n    // your existing config\n  });\n\nOr with ES modules (next.config.mjs):\n\n  import withBeam from '@byronwade/beam/next';\n  export default withBeam({\n    // your existing config\n  });\n`;\n\n    case \"vite\":\n    case \"remix\":\n    case \"sveltekit\":\n      return `\nAdd Beam to your vite.config.ts:\n\n  import beam from '@byronwade/beam/vite';\n\n  export default {\n    plugins: [beam()],\n  };\n`;\n\n    case \"astro\":\n      return `\nAdd Beam to your astro.config.mjs:\n\n  import beam from '@byronwade/beam/astro';\n\n  export default {\n    integrations: [beam()],\n  };\n`;\n\n    case \"nuxt\":\n      return `\nAdd Beam to your nuxt.config.ts:\n\n  export default defineNuxtConfig({\n    modules: ['@byronwade/beam/nuxt'],\n  });\n`;\n\n    default:\n      return `\nFor generic projects, Beam will auto-detect ports.\nJust run your dev server and Beam will tunnel it.\n\nOr use the CLI directly:\n  beam 3000\n`;\n  }\n}\n","#!/usr/bin/env node\n/**\n * Beam Auto-Setup Script\n *\n * This script runs on `npm install @byronwade/beam` (or bmup) and:\n * 1. Detects the user's framework\n * 2. Provides setup instructions\n * 3. Optionally auto-configures (with user consent)\n *\n * This is a postinstall script - it should be non-intrusive and fast.\n */\n\nimport { detectFramework, getSetupInstructions } from \"./frameworks/index.js\";\nimport chalk from \"chalk\";\n\nfunction main() {\n  // Don't run in CI or production\n  if (process.env.CI || process.env.NODE_ENV === \"production\") {\n    return;\n  }\n\n  // Don't run if BEAM_SKIP_SETUP is set\n  if (process.env.BEAM_SKIP_SETUP === \"true\") {\n    return;\n  }\n\n  try {\n    const framework = detectFramework();\n\n    console.log(\"\");\n    console.log(chalk.cyan(\"âš¡ beam\") + \" installed successfully!\");\n    console.log(\"\");\n\n    if (framework.type !== \"unknown\") {\n      console.log(chalk.dim(`   Detected: ${framework.name}${framework.version ? ` ${framework.version}` : \"\"}`));\n      console.log(\"\");\n\n      // Show quick setup hint\n      switch (framework.type) {\n        case \"nextjs\":\n          console.log(chalk.dim(\"   Quick setup:\"));\n          console.log(chalk.white(\"   1. Add to next.config.js:\"));\n          console.log(chalk.dim(\"      const withBeam = require('@byronwade/beam/next');\"));\n          console.log(chalk.dim(\"      module.exports = withBeam({ /* config */ });\"));\n          console.log(\"\");\n          console.log(chalk.white(\"   2. Run:\") + chalk.cyan(\" npm run dev\"));\n          console.log(chalk.dim(\"      Tunnel URL will appear in your Next.js logs!\"));\n          break;\n\n        case \"vite\":\n        case \"remix\":\n        case \"sveltekit\":\n          console.log(chalk.dim(\"   Quick setup:\"));\n          console.log(chalk.white(\"   1. Add to vite.config.ts:\"));\n          console.log(chalk.dim(\"      import beam from '@byronwade/beam/vite';\"));\n          console.log(chalk.dim(\"      export default { plugins: [beam()] };\"));\n          console.log(\"\");\n          console.log(chalk.white(\"   2. Run:\") + chalk.cyan(\" npm run dev\"));\n          console.log(chalk.dim(\"      Tunnel URL will appear in your Vite logs!\"));\n          break;\n\n        case \"astro\":\n          console.log(chalk.dim(\"   Quick setup:\"));\n          console.log(chalk.white(\"   1. Add to astro.config.mjs:\"));\n          console.log(chalk.dim(\"      import beam from '@byronwade/beam/astro';\"));\n          console.log(chalk.dim(\"      export default { integrations: [beam()] };\"));\n          console.log(\"\");\n          console.log(chalk.white(\"   2. Run:\") + chalk.cyan(\" npm run dev\"));\n          console.log(chalk.dim(\"      Tunnel URL will appear in your Astro logs!\"));\n          break;\n\n        case \"nuxt\":\n          console.log(chalk.dim(\"   Quick setup:\"));\n          console.log(chalk.white(\"   1. Add to nuxt.config.ts:\"));\n          console.log(chalk.dim(\"      export default defineNuxtConfig({\"));\n          console.log(chalk.dim(\"        modules: ['@byronwade/beam/nuxt'],\"));\n          console.log(chalk.dim(\"      });\"));\n          console.log(\"\");\n          console.log(chalk.white(\"   2. Run:\") + chalk.cyan(\" npm run dev\"));\n          console.log(chalk.dim(\"      Tunnel URL will appear in your Nuxt logs!\"));\n          break;\n      }\n    } else {\n      console.log(chalk.dim(\"   For any project, just run:\"));\n      console.log(chalk.cyan(\"   beam 3000\"));\n      console.log(chalk.dim(\"   (replace 3000 with your port)\"));\n    }\n\n    console.log(\"\");\n    console.log(chalk.dim(\"   Tip: Run\") + chalk.cyan(\" beam login\") + chalk.dim(\" for persistent subdomains\"));\n    console.log(chalk.dim(\"   Docs: https://beam.byronwade.com/docs\"));\n    console.log(\"\");\n  } catch (error) {\n    // Silently fail - postinstall scripts should not break npm install\n    if (process.env.DEBUG) {\n      console.error(\"Beam auto-setup error:\", error);\n    }\n  }\n}\n\nmain();\n"],"mappings":"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","names":[]}