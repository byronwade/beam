{"version":3,"sources":["../src/webhook-bridge.ts","../src/internet-manager.ts","../src/https-proxy.ts","../src/index.ts","../src/tunnel.ts","../src/network-manager.ts","../src/beam-dns.ts","../src/hosts-manager.ts"],"sourcesContent":["import express from 'express';\nimport { createProxyMiddleware } from 'http-proxy-middleware';\nimport https from 'https';\nimport http from 'http';\nimport { spawn } from 'child_process';\nimport crypto from 'crypto';\n\nexport type TunnelService = 'localtunnel' | 'ngrok' | 'serveo' | 'cloudflared';\n\nexport interface WebhookBridgeOptions {\n    localPort: number;\n    httpsPort: number;\n    onionAddress: string;\n    customDomain?: string;\n    tunnelService?: TunnelService;\n}\n\nexport class WebhookBridge {\n    private app: express.Application;\n    private server: http.Server | https.Server | null = null;\n    private tunnelProcess: any = null;\n\n    constructor(private options: WebhookBridgeOptions) {\n        this.app = express();\n\n        // Enable CORS for webhook services\n        this.app.use((req, res, next) => {\n            res.header('Access-Control-Allow-Origin', '*');\n            res.header('Access-Control-Allow-Methods', 'GET, POST, PUT, DELETE, OPTIONS');\n            res.header('Access-Control-Allow-Headers', 'Origin, X-Requested-With, Content-Type, Accept, Authorization');\n            if (req.method === 'OPTIONS') {\n                res.sendStatus(200);\n            } else {\n                next();\n            }\n        });\n\n        // Proxy all requests to the local tunnel\n        this.app.use('/', createProxyMiddleware({\n            target: `http://127.0.0.1:${options.localPort}`,\n            changeOrigin: true,\n            ws: true, // Support WebSocket upgrades\n            onError: (err, req, res) => {\n                console.error('Proxy error:', err);\n                res.status(502).send('Tunnel unavailable');\n            }\n        }));\n    }\n\n    async startBridge(): Promise<string> {\n        return new Promise((resolve, reject) => {\n            try {\n                // Start HTTPS tunnel (using a free service)\n                console.log('üöÄ Starting webhook bridge...');\n\n    // Choose tunnel service\n    const service = this.options.tunnelService || 'localtunnel';\n    let command: string[];\n    let spawnCmd: string;\n\n    switch (service) {\n      case 'ngrok':\n        spawnCmd = 'ngrok';\n        command = ['http', this.options.httpsPort.toString()];\n        break;\n      case 'serveo':\n        spawnCmd = 'ssh';\n        command = ['-R', `80:localhost:${this.options.httpsPort}`, 'serveo.net'];\n        break;\n      case 'cloudflared':\n        spawnCmd = 'cloudflared';\n        command = ['tunnel', '--url', `http://localhost:${this.options.httpsPort}`];\n        break;\n      case 'localtunnel':\n      default:\n        spawnCmd = 'npx';\n        command = [\n          'localtunnel',\n          '--port', this.options.httpsPort.toString(),\n          '--subdomain', this.options.customDomain || `beam-${Date.now()}`\n        ];\n        break;\n    }\n\n    this.tunnelProcess = spawn(spawnCmd, command, {\n                    stdio: ['pipe', 'pipe', 'pipe']\n                });\n\n                let tunnelUrl = '';\n                let started = false;\n\n                this.tunnelProcess.stdout.on('data', (data: Buffer) => {\n                    const output = data.toString();\n                    console.log('Tunnel:', output.trim());\n\n                    // Extract the tunnel URL\n                    const urlMatch = output.match(/https:\\/\\/[^\\s]+/);\n                    if (urlMatch && !started) {\n                        tunnelUrl = urlMatch[0];\n                        started = true;\n                        console.log(`üîó Webhook URL: ${tunnelUrl}`);\n                        resolve(tunnelUrl);\n                    }\n                });\n\n                this.tunnelProcess.stderr.on('data', (data: Buffer) => {\n                    console.error('Tunnel error:', data.toString());\n                });\n\n                this.tunnelProcess.on('close', (code: number) => {\n                    if (code !== 0) {\n                        reject(new Error(`Tunnel process exited with code ${code}`));\n                    }\n                });\n\n                // Fallback timeout\n                setTimeout(() => {\n                    if (!started) {\n                        reject(new Error('Timeout waiting for tunnel to start'));\n                    }\n                }, 30000);\n\n            } catch (error) {\n                reject(error);\n            }\n        });\n    }\n\n    startLocalServer(): void {\n        // Start local HTTPS server\n        const httpsOptions = {\n            // For demo purposes - in production you'd use proper certificates\n            key: null,\n            cert: null\n        };\n\n        this.server = http.createServer(this.app);\n        this.server.listen(this.options.httpsPort, () => {\n            console.log(`üîí Local HTTPS server listening on port ${this.options.httpsPort}`);\n        });\n    }\n\n    stop(): void {\n        if (this.server) {\n            this.server.close();\n        }\n        if (this.tunnelProcess) {\n            this.tunnelProcess.kill();\n        }\n    }\n}\n","// @ts-ignore\nimport NatAPI from 'nat-api';\nimport util from 'util';\n\nexport class InternetManager {\n    private client: NatAPI;\n    private mappedPorts: Set<number> = new Set();\n\n    constructor() {\n        this.client = new NatAPI();\n    }\n\n    /**\n     * Map a public port to a local private port using UPnP/PMP\n     */\n    async mapPort(publicPort: number, privatePort: number): Promise<boolean> {\n        return new Promise((resolve) => {\n            this.client.map(publicPort, privatePort, (err) => {\n                if (err) {\n                    console.error(`   ‚ùå Failed to map port ${publicPort}:`, err.message);\n                    resolve(false);\n                } else {\n                    console.log(`   ‚úÖ Port mapped: Public :${publicPort} ‚Üí Local :${privatePort}`);\n                    this.mappedPorts.add(publicPort);\n                    resolve(true);\n                }\n            });\n        });\n    }\n\n    /**\n     * Unmap a specific port\n     */\n    async unmapPort(publicPort: number): Promise<void> {\n        return new Promise((resolve) => {\n            this.client.unmap(publicPort, (err) => {\n                if (err) {\n                    // ignore errors on cleanup\n                } else {\n                    console.log(`   üßπ Port unmapped: :${publicPort}`);\n                }\n                this.mappedPorts.delete(publicPort);\n                resolve();\n            });\n        });\n    }\n\n    /**\n     * Get the public IP address\n     */\n    async getPublicIP(): Promise<string | null> {\n        return new Promise((resolve) => {\n            this.client.externalIp((err, ip) => {\n                if (err) {\n                    resolve(null);\n                } else {\n                    resolve(ip);\n                }\n            });\n        });\n    }\n\n    /**\n     * Cleanup all mapped ports\n     */\n    async cleanup(): Promise<void> {\n        if (this.mappedPorts.size === 0) return;\n\n        console.log('   üßπ Cleaning up internet mappings...');\n        const promises = Array.from(this.mappedPorts).map(port => this.unmapPort(port));\n        await Promise.all(promises);\n    }\n}\n","// @ts-ignore\nimport selfsigned from 'selfsigned';\nimport httpProxy from 'http-proxy';\nimport https from 'https';\nimport http from 'http';\nimport os from 'os';\n\nexport class HttpsProxy {\n    private proxy: httpProxy;\n    private server: https.Server | null = null;\n    private listenPort: number = 0;\n\n    constructor() {\n        this.proxy = httpProxy.createProxyServer({});\n\n        // Handle proxy errors silently to avoid crashing\n        this.proxy.on('error', (err, req, res) => {\n            const socket = res as any; // Handle socket type\n            if (socket.headersSent) return;\n\n            if (res instanceof http.ServerResponse) {\n                res.writeHead(502);\n                res.end('Gateway error: ' + err.message);\n            }\n        });\n    }\n\n    /**\n     * Start the HTTPS proxy referencing a local HTTP target\n     */\n    async start(targetPort: number, requestedListenPort?: number, publicIp?: string): Promise<{ port: number, domain: string, trusted: boolean }> {\n        console.log('   üîê Generating self-signed certificate...');\n\n        // Generate a self-signed certificate with valid Extensions for localhost usage\n        const attrs = [{ name: 'commonName', value: 'localhost' }];\n\n        // Handle selfsigned callback or promise if available (it usually is callback based in older versions, checking types)\n        // We'll wrap it in a promise to be safe\n        // Discover local IPs to add to SANs (Subject Alternative Names)\n        const interfaces = os.networkInterfaces();\n        const ips = ['127.0.0.1', 'localhost'];\n        for (const name of Object.keys(interfaces)) {\n            for (const iface of interfaces[name] || []) {\n                if (iface.family === 'IPv4' && !iface.internal) {\n                    ips.push(iface.address);\n                }\n            }\n        }\n\n        // Add specific public IP if known (passed via method if possible, or just trust catch-all)\n        // For now, adding all local IPs covers the NAT scenario if the router forwards to one of them.\n        if (publicIp && !ips.includes(publicIp)) {\n            ips.push(publicIp);\n        }\n\n        const altNames = ips.map(ip => ({ type: 7, ip: ip })); // Type 7 is IP Address\n\n        // Also add DNS names if needed (not needed for raw IP access usually, but good practice)\n        // Note: selfsigned handles this via 'extensions' usually if we construct it right, \n        // OR we can pass it as a separate 'altNames' option in some versions, but standard x509 requires it in extensions.\n        // selfsigned generic approach:\n\n        const extensions = [\n            { name: 'basicConstraints', cA: true },\n            {\n                name: 'subjectAltName',\n                altNames: altNames\n            }\n        ];\n\n        let pems: any;\n        let activeDomain = publicIp || 'localhost'; // Default to IP or localhost\n        let isTrusted = false;\n\n        // Try devcert for trusted SSL (Green Lock) if plausible\n        // Note: devcert handles root CA installation (requires sudo on first run)\n        try {\n            // console.log('   üîê Attempting to generate Trusted Certificate (may require sudo)...'); // This log is now inside the loop\n\n            // @ts-ignore\n            const { certificateFor } = await import('devcert');\n\n            // devcert strictly requires a domain name, not an IP.\n            // STRATEGY: Try multiple wildcard DNS services: nip.io -> sslip.io\n            // If one works, we use it.\n            let domainsToTry: string[] = [];\n            if (publicIp) {\n                domainsToTry.push(`${publicIp}.nip.io`);\n                domainsToTry.push(`${publicIp}.sslip.io`);\n            } else {\n                domainsToTry.push('localhost');\n            }\n\n            // Also support lvh.me for local\n            if (!publicIp || publicIp === '127.0.0.1') {\n                domainsToTry.push('lvh.me');\n            }\n\n            let lastError;\n            for (const domain of domainsToTry) {\n                try {\n                    console.log(`   üîê Attempting to generate Trusted Certificate for ${domain}...`);\n                    pems = await certificateFor(domain, { skipCertutilInstall: false, skipHostsFile: true });\n                    activeDomain = domain;\n                    isTrusted = true;\n                    console.log(`   ‚úÖ Trusted Certificate generated for ${activeDomain}!`);\n                    break; // Success!\n                } catch (err) {\n                    console.log(`   ‚ö†Ô∏è  Failed to generate for ${domain}. Trying next...`);\n                    lastError = err;\n                    // Continue to next candidate\n                }\n            }\n\n            if (!isTrusted) {\n                throw lastError || new Error(\"All trusted domain attempts failed.\");\n            }\n\n            // devcert returns { key: Buffer, cert: Buffer }\n\n        } catch (devcertError) {\n            console.log('   ‚ö†Ô∏è  Trusted Certificate failed. Falling back to self-signed...');\n            // console.error(\"Debug: devcert error:\", devcertError); \n\n            // Fallback to original selfsigned logic\n            // If fallback, activeDomain reverts to IP/localhost usage (technically the URL will still be reachable via IP)\n            // But for consistency we might want to stick to the IP access in fallback mode.\n            // We'll leave activeDomain as the tried one?? No, if fallback, we usually access via IP.\n            // But let's return whatever we successfully certed? \n            // Selfsigned certs cover IPs. So we can return IP or .nip.io?\n            if (publicIp) activeDomain = publicIp;\n            isTrusted = false;\n\n            try {\n                // @ts-ignore\n                pems = await selfsigned.generate(attrs, {\n                    keySize: 2048,\n                    algorithm: 'sha256',\n                    // @ts-ignore\n                    extensions: extensions\n                });\n            } catch (error) {\n                throw error;\n            }\n        }\n\n        const options = {\n            key: pems.key || pems.private, // devcert uses 'key', selfsigned uses 'private'\n            cert: pems.cert,\n        };\n\n        return new Promise((resolve, reject) => {\n            this.server = https.createServer(options, (req, res) => {\n                this.proxy.web(req, res, { target: `http://127.0.0.1:${targetPort}` }, (err) => {\n                    // Silent proxy error handling or minimal log\n                    if (!res.headersSent) {\n                        res.writeHead(502);\n                        res.end('Bad Gateway');\n                    }\n                });\n            });\n\n            // Allow self-signed certs at the proxy level too if needed (though we proxy to http usually)\n            // this.proxy.on('error') is handled globally in constructor, let's enable verbose log there too.\n\n            // If no listen port requested, let OS choose (0)\n            const port = requestedListenPort || 0;\n\n            this.server.listen(port, '0.0.0.0', () => {\n                const address = this.server?.address();\n                if (address && typeof address !== 'string') {\n                    this.listenPort = address.port;\n                    resolve({ port: this.listenPort, domain: activeDomain, trusted: isTrusted });\n                } else {\n                    reject(new Error('Failed to get bound port'));\n                }\n            });\n\n            this.server.on('error', (err) => {\n                reject(err);\n            });\n        });\n    }\n\n    stop() {\n        if (this.server) {\n            this.server.close();\n            this.server = null;\n        }\n        this.proxy.close();\n    }\n}\n","#!/usr/bin/env node\nimport { Command } from \"commander\";\nimport { spawn, ChildProcess, execSync } from \"child_process\";\nimport fs from \"fs\";\nimport os from \"os\";\nimport path from \"path\";\nimport http from \"http\";\nimport { TunnelManager, TunnelOptions } from \"./tunnel\";\n\n// Export for plugins\nexport { TunnelManager, TunnelOptions };\n\nimport { BeamDNSManager } from \"./beam-dns\";\n\nasync function handleInteractiveDomainRegistration(port: number, customDomain?: string): Promise<string | null> {\n  const dnsManager = new BeamDNSManager();\n  const isConfigured = await dnsManager.isBeamConfigured();\n\n  if (!isConfigured) {\n    console.log(`\nüåê Beam Global Domain Registration\n‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ\n\nTo make your tunnel accessible worldwide, Beam can register a .beam domain\nthat works from any internet connection.\n\nThis one-time setup will:\n‚Ä¢ Configure your DNS for .beam domain resolution\n‚Ä¢ Create a permanent domain for your project\n‚Ä¢ Enable webhook delivery and collaborator access\n\nYour current DNS settings will be backed up automatically.\n\n`);\n\n    const readline = await import('readline');\n    const rl = readline.createInterface({\n      input: process.stdin,\n      output: process.stdout\n    });\n\n    return new Promise((resolve) => {\n      rl.question('Register global .beam domain? (y/N): ', async (answer) => {\n        rl.close();\n\n        if (answer.toLowerCase() === 'y' || answer.toLowerCase() === 'yes') {\n          console.log('\\nüîß Setting up global .beam domains...');\n\n          const platform = dnsManager.getPlatformName();\n          const needsPrivileges = dnsManager.needsPrivileges(os.platform());\n\n          if (needsPrivileges) {\n            console.log(`‚ö†Ô∏è  ${platform} requires elevated privileges for DNS changes.`);\n            console.log('');\n            console.log('üìã Manual DNS Setup:');\n            console.log('   1. Go to System Settings > Network > Wi-Fi > Advanced > DNS');\n            console.log('   2. Add DNS server: 161.97.219.82');\n            console.log('   3. Keep your current DNS servers as backup');\n            console.log('   4. Apply changes and test with: nslookup test.beam');\n            console.log('');\n            console.log('üí° Or run with sudo: sudo beam ' + port);\n            console.log('');\n            resolve(null);\n            return;\n          }\n\n          const success = await dnsManager.configureBeamDNS();\n\n          if (success) {\n            console.log('‚úÖ Global .beam domains activated!');\n            console.log('   Your system now resolves .beam domains worldwide.');\n            console.log('');\n\n            // Generate domain name\n            const projectName = customDomain || getProjectName();\n            const domain = `${projectName}.beam`;\n\n            console.log(`üéâ Your permanent domain: ${domain}`);\n            console.log(`   Works from any device, anywhere on the internet!`);\n            console.log('');\n            console.log('üß™ Test your setup:');\n            console.log(`   beam test ${domain}`);\n            console.log('');\n\n            resolve(domain);\n          } else {\n            console.log('‚ùå DNS setup failed.');\n            console.log('');\n            console.log('üí° Possible solutions:');\n            console.log('   1. Check your internet connection');\n            console.log('   2. Try: beam dns-setup (manual setup)');\n            console.log('   3. Configure DNS manually: 161.97.219.82');\n            console.log('   4. Use: beam 3000 --webhook-bridge (alternative)');\n            console.log('');\n            console.log('üîÑ Your original DNS settings have been restored.');\n            console.log('');\n            resolve(null);\n          }\n        } else {\n          console.log('\\n‚ÑπÔ∏è  Using local-only access.');\n          console.log('   Available at: http://127.0.0.1:4005');\n          console.log('   Enable global access anytime with: beam dns-setup');\n          console.log('');\n          resolve(null);\n        }\n      });\n    });\n  } else {\n    // Already configured, generate domain\n    const projectName = customDomain || getProjectName();\n    return `${projectName}.beam`;\n  }\n}\n\nfunction getProjectName(): string {\n  try {\n    // Try to get project name from package.json\n    const pkgPath = path.join(process.cwd(), 'package.json');\n    if (fs.existsSync(pkgPath)) {\n      const pkg = JSON.parse(fs.readFileSync(pkgPath, 'utf8'));\n      if (pkg.name) {\n        // Clean up name for domain use\n        return pkg.name.replace(/[^a-zA-Z0-9]/g, '').toLowerCase();\n      }\n    }\n  } catch { }\n\n  // Fallback to random name\n  return `beam-${Date.now().toString(36)}`;\n}\n\nasync function testDNSResolution(domain: string): Promise<boolean> {\n  return new Promise((resolve) => {\n    const { spawn } = require('child_process');\n    const nslookup = spawn('nslookup', [domain], { timeout: 5000 });\n\n    let output = '';\n    nslookup.stdout.on('data', (data: Buffer) => {\n      output += data.toString();\n    });\n\n    nslookup.on('close', (code: number) => {\n      resolve(code === 0 && output.includes('Address:'));\n    });\n\n    nslookup.on('error', () => resolve(false));\n  });\n}\n\nasync function testHTTPConnectivity(url: string): Promise<boolean> {\n  return new Promise((resolve) => {\n    const https = require('https');\n    const http = require('http');\n\n    const client = url.startsWith('https:') ? https : http;\n    const req = client.request(url, { method: 'HEAD', timeout: 5000 }, (res: any) => {\n      resolve(res.statusCode < 400);\n    });\n\n    req.on('error', () => resolve(false));\n    req.on('timeout', () => {\n      req.destroy();\n      resolve(false);\n    });\n\n    req.end();\n  });\n}\n\nasync function setupWebhookBridge(port: number, options: any, daemon: ChildProcess): Promise<void> {\n  try {\n    // Import webhook bridge dynamically to avoid build issues\n    const { WebhookBridge } = await import(\"./webhook-bridge\");\n\n    const webhookPort = port + 1; // Use next port for HTTPS\n    const bridge = new WebhookBridge({\n      localPort: port,\n      httpsPort: webhookPort,\n      onionAddress: \"\", // Will be filled from daemon output\n      customDomain: options.webhookDomain,\n      tunnelService: options.tunnelService\n    });\n\n    // Start local HTTPS server\n    bridge.startLocalServer();\n\n    // Start tunnel to public HTTPS endpoint\n    const webhookUrl = await bridge.startBridge();\n\n    console.log(\"üîó Webhook Bridge Active!\");\n    console.log(`   HTTPS URL: ${webhookUrl}`);\n    console.log(`   Local proxy: http://127.0.0.1:${port}`);\n    console.log(`   Onion: [will be shown when tunnel starts]`);\n    console.log(\"\");\n    console.log(\"üìã Use this URL for 3rd party webhooks:\");\n    console.log(`   ${webhookUrl}`);\n    console.log(\"\");\n    console.log(\"üí° This provides HTTPS access for services that don't support .onion\");\n\n    // Cleanup on exit\n    const cleanup = () => {\n      console.log(\"\\nüõë Shutting down webhook bridge...\");\n      bridge.stop();\n    };\n\n    process.on(\"SIGINT\", cleanup);\n    process.on(\"SIGTERM\", cleanup);\n\n  } catch (error) {\n    console.error(\"‚ùå Failed to setup webhook bridge:\", error instanceof Error ? error.message : String(error));\n    console.log(\"üí° Make sure you have Node.js and npm installed for the tunnel service\");\n  }\n}\n\nconst CONFIG_DIR = path.join(os.homedir(), \".beam\");\nconst CONFIG_PATH = path.join(CONFIG_DIR, \"credentials.json\");\n\n/**\n * Tunnel Mode Types\n */\ntype TunnelMode = \"fast\" | \"balanced\" | \"private\";\n\nconst MODE_INFO: Record<TunnelMode, { latency: string; privacy: string; description: string }> = {\n  fast: {\n    latency: \"~30-50ms\",\n    privacy: \"Low (IP visible)\",\n    description: \"Direct P2P connection for maximum speed\"\n  },\n  balanced: {\n    latency: \"~80-150ms\",\n    privacy: \"Medium (server exposed, clients hidden)\",\n    description: \"Single-hop Tor for good balance of speed and privacy\"\n  },\n  private: {\n    latency: \"~200-500ms\",\n    privacy: \"High (full anonymity)\",\n    description: \"Full 3-hop Tor onion routing for maximum privacy\"\n  }\n};\n\n// ... (Helper functions like findProjectRoot, saveToken, loadToken kept if needed by other parts, \n// though TunnelManager handles project root now. keeping for safety of existing utils)\n\nfunction validateMode(mode: string): TunnelMode {\n  const validModes: TunnelMode[] = [\"fast\", \"balanced\", \"private\"];\n  if (!validModes.includes(mode as TunnelMode)) {\n    console.error(`‚ùå Invalid mode: ${mode}`);\n    process.exit(1);\n  }\n  return mode as TunnelMode;\n}\n\nconst tunnelManager = new TunnelManager();\n\nasync function startTunnelDaemon(port: number, options: any): Promise<void> {\n  const mode: TunnelMode = options.mode ? validateMode(options.mode) : \"balanced\";\n\n  const tunnelOptions: TunnelOptions = {\n    targetPort: port,\n    domain: options.domain,\n    mode: mode,\n    dnsPort: options.dnsPort,\n    torPort: options.torPort,\n    https: options.https,\n    httpsPort: options.httpsPort,\n    verbose: options.verbose,\n    cache: options.cache !== false,\n    cacheSize: options.cacheSize,\n    cacheTtl: options.cacheTtl,\n    geoPrefer: options.geoPrefer,\n    prebuildCircuits: options.prebuildCircuits,\n    noPrebuild: options.noPrebuild,\n  };\n\n  console.log(\"üöÄ Starting tunnel daemon...\");\n  console.log(`   Mode: ${mode} (${MODE_INFO[mode].description})`);\n\n  try {\n    const daemon = await tunnelManager.start(tunnelOptions);\n\n    // DNS opt-in for .beam domains (only if not webhook bridge)\n    if (!options.webhookBridge && !options.domain) {\n      const registeredDomain = await handleInteractiveDomainRegistration(port);\n      if (registeredDomain) {\n        // Update the tunnel with the registered domain\n        console.log(`üîÑ Updating tunnel to use: ${registeredDomain}`);\n        // Note: Tunnel daemon hot-reloading domain isn't fully supported yet without restart, \n        // but for now we assume consistency.\n      }\n    } else if (options.domain && options.domain.endsWith('.beam')) {\n      // Ensure DNS is configured for this specific domain\n      const dnsManager = new BeamDNSManager();\n      await dnsManager.configureForDomain(options.domain);\n    }\n\n    // Handle webhook bridge if requested\n    if (options.webhookBridge) {\n      console.log(\"üîó Setting up webhook bridge...\");\n      await setupWebhookBridge(port, options, daemon);\n    }\n\n    // Pipe output to console for CLI usage\n    daemon.stdout?.pipe(process.stdout);\n    daemon.stderr?.pipe(process.stderr);\n\n    // Wait for daemon to initialize\n    await new Promise(resolve => setTimeout(resolve, 2000));\n\n    // Handle shutdown\n    const cleanup = () => {\n      console.log(\"\\nüõë Shutting down...\");\n      tunnelManager.stop();\n      process.exit(0);\n    };\n\n    process.on(\"SIGINT\", cleanup);\n    process.on(\"SIGTERM\", cleanup);\n\n    // Handle daemon exit\n    daemon.on(\"close\", (code) => {\n      if (code !== 0) {\n        console.error(`‚ùå Tunnel daemon exited with code ${code}`);\n        process.exit(code || 1);\n      }\n    });\n\n  } catch (error: any) {\n    console.error(\"‚ùå Failed to start tunnel:\", error instanceof Error ? error.message : String(error));\n    process.exit(1);\n  }\n}\n\nconst program = new Command();\n\nprogram\n  .name(\"beam\")\n  .description(\"Beam - Decentralized tunneling for developers\")\n  .version(\"1.1.34\");\n\n// 1. BEAM TUNNEL (Daemon Mode)\nprogram\n  .command(\"tunnel\")\n  .description(\"Start a private tunnel daemon (Tor/P2P)\")\n  .argument(\"<port>\", \"Local port to expose\", (v) => parseInt(v, 10))\n  .option(\"-d, --domain <name>\", \"Domain name to use (default .onion quick tunnel)\", `beam-${Date.now()}.onion`)\n  .option(\"-m, --mode <mode>\", \"Tunnel mode: fast, balanced, or private\", \"balanced\")\n  .option(\"--dns-port <port>\", \"DNS server port\", \"5353\")\n  .option(\"--tor-port <port>\", \"Tor control port\", \"9051\")\n  .option(\"--https\", \"Enable HTTPS with self-signed certificate\")\n  .option(\"--https-port <port>\", \"HTTPS port (defaults to HTTP port + 1)\")\n  .option(\"-v, --verbose\", \"Enable verbose logging\")\n  .option(\"--no-cache\", \"Disable response caching\")\n  .option(\"--cache-size <mb>\", \"Cache size in MB\", \"100\")\n  .option(\"--cache-ttl <seconds>\", \"Cache TTL in seconds\", \"300\")\n  .option(\"--geo-prefer <countries>\", \"Preferred relay countries (comma-separated ISO codes)\")\n  .option(\"--prebuild-circuits <count>\", \"Number of circuits to prebuild\", \"3\")\n  .option(\"--no-prebuild\", \"Disable circuit prebuilding\")\n  .option(\"--webhook-bridge\", \"Create HTTPS webhook bridge for 3rd party services\")\n  .option(\"--webhook-domain <domain>\", \"Custom subdomain for webhook bridge\")\n  .option(\"--tunnel-service <service>\", \"Tunnel service: localtunnel, ngrok, serveo, cloudflared\", \"localtunnel\")\n  .alias(\"start\") // Backward compatibility\n  .action(async (port: number, options) => {\n    await startTunnelDaemon(port, options);\n  });\n\n// 2. BEAM DNS (Management)\nconst dnsCommand = program.command(\"dns\").description(\"Manage decentralized DNS settings\");\n\ndnsCommand\n  .command(\"setup\")\n  .description(\"Configure system for .beam domain resolution\")\n  .action(async () => {\n    const dnsManager = new BeamDNSManager();\n    await dnsManager.configureBeamDNS();\n    console.log('\\n‚úÖ DNS Setup Triggered');\n  });\n\ndnsCommand\n  .command(\"status\")\n  .description(\"Check DNS configuration status\")\n  .action(async () => {\n    const dnsManager = new BeamDNSManager();\n    const configured = await dnsManager.isBeamConfigured();\n    console.log(`\\nDNS Status: ${configured ? '‚úÖ Configured' : '‚ùå Not Configured'}`);\n    if (!configured) console.log('Run \"beam dns setup\" to fix.');\n  });\n\ndnsCommand\n  .command(\"test <domain>\")\n  .description(\"Test domain resolution\")\n  .action(async (domain) => {\n    const result = await testDNSResolution(domain);\n    console.log(`Resolution Test: ${result ? '‚úÖ Passed' : '‚ùå Failed'}`);\n  });\n\n// Internet Mode (UPnP) Logic\nasync function startInternetMode(port: number): Promise<void> {\n  console.log('üåê DIRECT INTERNET MODE (+HTTPS)');\n  console.log('=======================');\n  console.log('Exposing your local port directly to the internet via UPnP/NAT-PMP.');\n  console.log('‚ö†Ô∏è  No 3rd party relays involved. Your IP will be visible.');\n  console.log('');\n\n  const { InternetManager } = await import('./internet-manager');\n  const { HttpsProxy } = await import('./https-proxy');\n\n  const internet = new InternetManager();\n  const httpsProxy = new HttpsProxy();\n\n  console.log('üîç Discovering Public IP...');\n  const publicIp = await internet.getPublicIP();\n\n  if (!publicIp) {\n    console.error('‚ùå Could not discover public IP. Are you connected to the internet?');\n    process.exit(1);\n  }\n  console.log(`   Public IP: ${publicIp}`);\n\n  console.log('üîí Starting Local HTTPS Proxy...');\n  // Pass public IP to generate valid cert for it\n  const { port: proxyPort, domain: certDomain, trusted: isTrusted } = await httpsProxy.start(port, 0, publicIp);\n\n  console.log('üîì Opening Public Port...');\n  // We map the PROXY port, not the raw HTTP port\n  // We try to reuse the requested port as the public facing port if possible for UX\n  let publicPort = port;\n  let mapped = await internet.mapPort(publicPort, proxyPort);\n\n  if (!mapped) {\n    console.log('   ‚ö†Ô∏è  Port ' + port + ' is unavailable or UPnP failed.');\n    console.log('   üîÑ Retrying with random port...');\n    publicPort = Math.floor(Math.random() * (65535 - 10000 + 1) + 10000);\n    mapped = await internet.mapPort(publicPort, proxyPort);\n  }\n\n  if (!mapped) {\n    console.error('‚ùå UPnP Port Mapping failed.');\n    console.error('   ‚Ä¢ Check if UPnP is enabled on your router.');\n    console.error('   ‚Ä¢ You may need to manually forward port ' + port);\n    process.exit(1);\n  }\n\n  console.log('');\n  console.log('üéâ ONLINE!');\n  // Use the domain that matched the certificate (e.g. nip.io or localhost or IP)\n  console.log(`   URL: https://${certDomain}:${publicPort}`);\n\n  if (isTrusted) {\n    console.log('   ‚úÖ Trusted Certificate (Green Lock Active) üîí');\n  } else {\n    console.log('   (Self-signed certificate - accept warning in browser)');\n  }\n\n  console.log('');\n  console.log('üí° Keep this terminal open. Port closes on exit.');\n  console.log('‚ÑπÔ∏è  Running in Direct Mode (Private & Free). Run \"beam start <port>\" for Tor mode.');\n\n  // Cleanup on exit\n  const cleanup = async () => {\n    console.log('\\nüõë Closing Internet Mode...');\n    await internet.cleanup();\n    httpsProxy.stop();\n    process.exit(0);\n  };\n\n  process.on('SIGINT', cleanup);\n  process.on('SIGTERM', cleanup);\n\n  // Keep process alive\n  setInterval(() => { }, 10000);\n}\n\n// (Legacy commands removed)\n\n// 4. DEFAULT MAGIC COMMAND (beam <port>)\nprogram\n  .argument(\"[port]\", \"Local port to expose\") // Optional to allow 'beam' (help) or 'beam <port>'\n  .allowUnknownOption(true) // Allow flags to pass through if mixing\n  .action(async (portStr, cmdOptions, command) => {\n    // Check if user ran a command that didn't match (e.g. beam invalid-cmd)\n\n    if (!portStr) {\n      // If no port and no args, show help\n      if (process.argv.length < 3) {\n        program.help();\n        return;\n      }\n    }\n\n    const port = parseInt(portStr, 10);\n    if (isNaN(port)) {\n      console.error(\"‚ùå Invalid command or port number.\");\n      process.exit(1);\n    }\n\n    // Heuristics: Did the user ask for Tunnel-specific things?\n    const rawArgs = process.argv.slice(2);\n    const isExplicitTunnel =\n      rawArgs.includes('--domain') ||\n      rawArgs.includes('-d') ||\n      rawArgs.includes('--webhook-bridge') ||\n      rawArgs.includes('--tor');\n\n    if (isExplicitTunnel) {\n      console.log(\"‚ÑπÔ∏è  Advanced flags detected. Switching to Tunnel Daemon...\");\n      console.log(\"‚ö†Ô∏è  Please use 'beam tunnel <port> [flags]' for advanced tunnel options.\");\n      console.log(\"   Redirecting you to 'beam tunnel'...\");\n      await startTunnelDaemon(port, program.opts());\n    } else {\n      await startInternetMode(port);\n    }\n  });\nexport interface Framework {\n  name: string;\n  command: string;\n  defaultPort: number;\n  test: (pkg: any) => boolean;\n}\n\nexport const FRAMEWORKS: Framework[] = [\n  {\n    name: \"Next.js\",\n    command: \"npm run dev\",\n    defaultPort: 3000,\n    test: (pkg) => pkg.dependencies?.next || pkg.devDependencies?.next\n  },\n  {\n    name: \"Vite\", // React, Vue, Svelte, etc.\n    command: \"npm run dev\",\n    defaultPort: 5173,\n    test: (pkg) => pkg.dependencies?.vite || pkg.devDependencies?.vite\n  },\n  {\n    name: \"Astro\",\n    command: \"npm run dev\",\n    defaultPort: 4321, // v3+ default\n    test: (pkg) => pkg.dependencies?.astro || pkg.devDependencies?.astro\n  },\n  {\n    name: \"Remix\",\n    command: \"npm run dev\",\n    defaultPort: 3000,\n    test: (pkg) => pkg.dependencies?.[\"@remix-run/react\"] || pkg.devDependencies?.[\"@remix-run/react\"]\n  },\n  {\n    name: \"Nuxt\",\n    command: \"npm run dev\",\n    defaultPort: 3000,\n    test: (pkg) => pkg.dependencies?.nuxt || pkg.devDependencies?.nuxt\n  },\n  {\n    name: \"SvelteKit\",\n    command: \"npm run dev\",\n    defaultPort: 5173,\n    test: (pkg) => pkg.devDependencies?.[\"@sveltejs/kit\"]\n  },\n  {\n    name: \"Angular\",\n    command: \"npm start\",\n    defaultPort: 4200,\n    test: (pkg) => pkg.dependencies?.[\"@angular/core\"] || pkg.devDependencies?.[\"@angular/cli\"]\n  },\n  {\n    name: \"NestJS\",\n    command: \"npm run start:dev\",\n    defaultPort: 3000,\n    test: (pkg) => pkg.dependencies?.[\"@nestjs/core\"]\n  },\n  {\n    name: \"Gatsby\",\n    command: \"npm run develop\",\n    defaultPort: 8000,\n    test: (pkg) => pkg.dependencies?.gatsby\n  },\n  {\n    name: \"SolidStart\",\n    command: \"npm run dev\",\n    defaultPort: 3000,\n    test: (pkg) => pkg.dependencies?.[\"solid-start\"] || pkg.devDependencies?.[\"solid-start\"]\n  },\n  {\n    name: \"Quasar\",\n    command: \"npm run dev\",\n    defaultPort: 9000,\n    test: (pkg) => pkg.dependencies?.quasar || pkg.devDependencies?.quasar\n  }\n];\n\nexport function detectFramework(pkg?: any): Framework | null {\n  try {\n    if (!pkg) {\n      const pkgPath = path.join(process.cwd(), \"package.json\");\n      if (!fs.existsSync(pkgPath)) return null;\n      pkg = JSON.parse(fs.readFileSync(pkgPath, \"utf8\"));\n    }\n    return FRAMEWORKS.find(f => f.test(pkg)) || null;\n  } catch {\n    return null;\n  }\n}\n\nasync function waitForPort(port: number, retries = 30): Promise<boolean> {\n  for (let i = 0; i < retries; i++) {\n    try {\n      await new Promise<void>((resolve, reject) => {\n        const req = http.request({\n          port,\n          method: 'HEAD',\n          timeout: 400\n        }, (res) => {\n          resolve();\n        });\n        req.on('error', reject);\n        req.end();\n      });\n      return true;\n    } catch {\n      await new Promise(r => setTimeout(r, 1000));\n    }\n  }\n  return false;\n}\n\nprogram\n  .command(\"dev\")\n  .description(\"Detect framework, start dev server, and create tunnel\")\n  .option(\"-p, --port <port>\", \"Force specific port (overrides detection)\")\n  .option(\"-c, --command <command>\", \"Custom dev command\")\n  .option(\"-d, --domain <name>\", \"Domain name to use\")\n  .option(\"-m, --mode <mode>\", \"Tunnel mode: fast, balanced, or private\", \"balanced\")\n  .action(async (options) => {\n    // ============================================\n    // PHASE 1: Setup SSL First (may require sudo)\n    // ============================================\n    console.log('');\n    console.log('üîí Beam Dev - Setting up Direct Mode...');\n    console.log('');\n\n    const { InternetManager } = await import('./internet-manager');\n    const { HttpsProxy } = await import('./https-proxy');\n\n    const internet = new InternetManager();\n    const httpsProxy = new HttpsProxy();\n\n    // Discover public IP\n    const publicIp = await internet.getPublicIP();\n    if (!publicIp) {\n      console.error('‚ùå Could not discover public IP. Check your internet connection.');\n      process.exit(1);\n    }\n\n    // Detect framework to get port\n    const framework = detectFramework();\n    let port = options.port;\n    let command = options.command;\n\n    if (framework) {\n      if (!port) port = framework.defaultPort;\n      if (!command) command = framework.command;\n    } else {\n      if (!port || !command) {\n        console.log(\"‚ö†Ô∏è  No supported framework detected.\");\n        if (!command) {\n          console.error(\"‚ùå You must specify a command with --command for unknown frameworks.\");\n          process.exit(1);\n        }\n        if (!port) {\n          console.error(\"‚ùå You must specify a port with --port for unknown frameworks.\");\n          process.exit(1);\n        }\n      }\n    }\n\n    // Pre-generate trusted certificate (this is where sudo prompt happens)\n    console.log('   Generating Trusted Certificate (may require password)...');\n    const { port: proxyPort, domain: certDomain, trusted: isTrusted } = await httpsProxy.start(port, 0, publicIp);\n\n    // Map port via UPnP\n    let publicPort = port;\n    let mapped = await internet.mapPort(publicPort, proxyPort);\n    if (!mapped) {\n      publicPort = Math.floor(Math.random() * (65535 - 10000 + 1) + 10000);\n      mapped = await internet.mapPort(publicPort, proxyPort);\n    }\n\n    if (!mapped) {\n      console.error('‚ùå UPnP Port Mapping failed. Check router settings.');\n      process.exit(1);\n    }\n\n    const beamUrl = `https://${certDomain}:${publicPort}`;\n\n    console.log('   ‚úÖ SSL Ready | Port Mapped');\n    console.log('');\n\n    // ============================================\n    // PHASE 2: Start Dev Server\n    // ============================================\n    const [cmd, ...args] = command.split(\" \");\n\n    const child = spawn(cmd, args, {\n      stdio: ['inherit', 'pipe', 'pipe'], // Pipe stdout/stderr for filtering\n      shell: true,\n      env: {\n        ...process.env,\n        PORT: port.toString(),\n        BEAM_URL: beamUrl,\n        BROWSER: \"none\",\n        NODE_NO_WARNINGS: \"1\" // Suppress Node deprecation warnings\n      }\n    });\n\n    // State for URL injection\n    let urlInjected = false;\n\n    // Filter and relay stdout\n    child.stdout?.on('data', (data: Buffer) => {\n      let line = data.toString();\n\n      // Suppress noisy lines\n      if (line.includes('DEP0190') || line.includes('DEP0060') || line.includes('util._extend') || line.includes('allowedDevOrigins')) {\n        return;\n      }\n\n      // Inject public URL after \"Local:\" line\n      if (!urlInjected && line.includes('- Local:')) {\n        process.stdout.write(line);\n        // Add our public URL line\n        const trustStatus = isTrusted ? 'üîí' : '‚ö†Ô∏è';\n        process.stdout.write(`   - Public:        ${beamUrl} ${trustStatus}\\n`);\n        urlInjected = true;\n        return;\n      }\n\n      process.stdout.write(line);\n    });\n\n    // Filter and relay stderr (mostly for Next.js warnings)\n    child.stderr?.on('data', (data: Buffer) => {\n      let line = data.toString();\n\n      // Suppress noisy warnings\n      if (line.includes('DEP0190') || line.includes('DEP0060') || line.includes('util._extend') || line.includes('allowedDevOrigins') || line.includes('proxyPrefetch')) {\n        return;\n      }\n\n      process.stderr.write(line);\n    });\n\n    // Wait for server to be ready\n    const ready = await waitForPort(port);\n\n    if (!ready) {\n      console.error(`‚ùå Timeout waiting for port ${port}. Is the dev server running?`);\n      child.kill();\n      httpsProxy.stop();\n      await internet.cleanup();\n      process.exit(1);\n    }\n\n    // ============================================\n    // PHASE 3: Keep Running\n    // ============================================\n    child.on('exit', () => {\n      console.log(\"\\nDev server exited.\");\n      httpsProxy.stop();\n      internet.cleanup();\n      process.exit(0);\n    });\n\n    const cleanup = async () => {\n      console.log('\\nüõë Shutting down...');\n      child.kill();\n      await internet.cleanup();\n      httpsProxy.stop();\n      process.exit(0);\n    };\n\n    process.on('SIGINT', cleanup);\n    process.on('SIGTERM', cleanup);\n  });\n\n// Only parse arguments when run directly or via the bin wrapper\nconst isDirectRun =\n  typeof process.argv[1] === \"string\" &&\n  (\n    // Direct run of this file\n    import.meta.url === `file://${path.resolve(process.argv[1])}` ||\n    // Run via bin/beam.js wrapper\n    process.argv[1].endsWith(\"beam.js\") ||\n    // Run via global link\n    process.argv[1].endsWith(\"/beam\") ||\n    process.argv[1].endsWith(\"\\\\beam\")\n  );\n\nif (isDirectRun) {\n  program.parse();\n}\n","import { spawn, ChildProcess } from \"child_process\";\nimport path from \"path\";\nimport fs from \"fs\";\nimport os from \"os\";\nimport https from \"https\";\nimport { NetworkManager } from \"./network-manager\";\n\nexport type TunnelMode = \"fast\" | \"balanced\" | \"private\";\n\nexport interface TunnelOptions {\n    targetPort: number;\n    domain?: string;\n    mode?: TunnelMode;\n    dnsPort?: number;\n    torPort?: number;\n    https?: boolean;\n    httpsPort?: number;\n    verbose?: boolean;\n    cache?: boolean;\n    cacheSize?: number;\n    cacheTtl?: number;\n    geoPrefer?: string;\n    prebuildCircuits?: number;\n    noPrebuild?: boolean;\n    projectRoot?: string;\n}\n\nexport class TunnelManager {\n    private daemon: ChildProcess | null = null;\n    private projectRoot: string;\n    private readonly DAEMON_VERSION = \"0.1.0\"; // Update to match released version\n    private readonly REPO_OWNER = \"byronwade\";\n    private readonly REPO_NAME = \"beam\";\n\n    constructor(projectRoot?: string) {\n        this.projectRoot = projectRoot || this.findProjectRoot();\n    }\n\n    private findProjectRoot(): string {\n        try {\n            let current = process.cwd();\n            const root = path.parse(current).root;\n\n            while (current !== root) {\n                if (fs.existsSync(path.join(current, \"package.json\"))) {\n                    const pkgPath = path.join(current, \"package.json\");\n                    try {\n                        const pkg = JSON.parse(fs.readFileSync(pkgPath, \"utf8\"));\n                        // Check if this is the monorepo root or a consumer usage\n                        if (pkg.name === \"@byronwade/beam\" || fs.existsSync(path.join(current, \"packages\", \"tunnel-daemon\"))) {\n                            return current;\n                        }\n                    } catch (e) {\n                        // ignore malformed package.json\n                    }\n                }\n                current = path.dirname(current);\n            }\n        } catch {\n            // ignore\n        }\n        return process.cwd();\n    }\n\n    private getCacheDir(): string {\n        const home = os.homedir();\n        const cacheDir = path.join(home, \".beam\", \"bin\");\n        if (!fs.existsSync(cacheDir)) {\n            fs.mkdirSync(cacheDir, { recursive: true });\n        }\n        return cacheDir;\n    }\n\n    private getDaemonFileName(): string {\n        const platform = os.platform();\n        const arch = os.arch();\n\n        let osName = \"\";\n        switch (platform) {\n            case \"darwin\": osName = \"apple-darwin\"; break;\n            case \"linux\": osName = \"unknown-linux-gnu\"; break;\n            case \"win32\": osName = \"pc-windows-msvc\"; break;\n            default: throw new Error(`Unsupported platform: ${platform}`);\n        }\n\n        let archName = \"\";\n        switch (arch) {\n            case \"x64\": archName = \"x86_64\"; break;\n            case \"arm64\": archName = \"aarch64\"; break;\n            default: throw new Error(`Unsupported architecture: ${arch}`);\n        }\n\n        const ext = platform === \"win32\" ? \".exe\" : \"\";\n        return `beam-tunnel-daemon-${archName}-${osName}${ext}`;\n    }\n\n    private getDaemonPath(): string {\n        // In dev/monorepo: packages/tunnel-daemon/target/release/beam-tunnel-daemon\n        const monorepoPath = path.join(this.projectRoot, \"packages/tunnel-daemon/target/release/beam-tunnel-daemon\");\n        if (fs.existsSync(monorepoPath)) {\n            return monorepoPath;\n        }\n\n        // Check cached path\n        const fileName = this.getDaemonFileName();\n        return path.join(this.getCacheDir(), fileName);\n    }\n\n    private async ensureDaemonAvailable(): Promise<string> {\n        const daemonPath = this.getDaemonPath();\n\n        if (fs.existsSync(daemonPath)) {\n            // Validate it's executable\n            try {\n                fs.accessSync(daemonPath, fs.constants.X_OK);\n            } catch {\n                await fs.promises.chmod(daemonPath, 0o755);\n            }\n            return daemonPath;\n        }\n\n        // Not found, try to download\n        console.log(\"   ‚Ä¢ Tunnel daemon not found locally. Downloading...\");\n        try {\n            await this.downloadDaemon(daemonPath);\n            console.log(\"   ‚úÖ Daemon downloaded successfully.\");\n            await fs.promises.chmod(daemonPath, 0o755);\n            return daemonPath;\n        } catch (error: any) {\n            throw new Error(`Failed to download tunnel daemon: ${error.message}`);\n        }\n    }\n\n    private async downloadDaemon(destPath: string): Promise<void> {\n        const fileName = this.getDaemonFileName();\n        const url = `https://github.com/${this.REPO_OWNER}/${this.REPO_NAME}/releases/download/v${this.DAEMON_VERSION}/${fileName}`;\n\n        return new Promise((resolve, reject) => {\n            const file = fs.createWriteStream(destPath);\n            https.get(url, (response) => {\n                if (response.statusCode === 302 || response.statusCode === 301) {\n                    // Handle redirect\n                    const redirectUrl = response.headers.location;\n                    if (!redirectUrl) {\n                        reject(new Error(\"Redirect location missing\"));\n                        return;\n                    }\n                    https.get(redirectUrl, (res) => {\n                        if (res.statusCode !== 200) {\n                            reject(new Error(`Failed to download: ${res.statusCode}`));\n                            return;\n                        }\n                        res.pipe(file);\n                        file.on('finish', () => {\n                            file.close();\n                            resolve();\n                        });\n                    }).on('error', (err) => {\n                        fs.unlink(destPath, () => { });\n                        reject(err);\n                    });\n                } else if (response.statusCode === 200) {\n                    response.pipe(file);\n                    file.on('finish', () => {\n                        file.close();\n                        resolve();\n                    });\n                } else {\n                    reject(new Error(`Failed to download: ${response.statusCode}`));\n                }\n            }).on('error', (err) => {\n                fs.unlink(destPath, () => { });\n                reject(err);\n            });\n        });\n    }\n\n    public async start(options: TunnelOptions): Promise<ChildProcess> {\n        // Stop existing daemon if running\n        if (this.daemon) {\n            this.stop();\n        }\n\n        const daemonPath = await this.ensureDaemonAvailable();\n        const network = await NetworkManager.getInstance().analyze();\n\n        const args = [\n            \"--target-port\", options.targetPort.toString(),\n            \"--domain\", options.domain || `beam-${Date.now()}.onion`,\n            \"--mode\", options.mode || \"balanced\"\n        ];\n\n        if (options.dnsPort) args.push(\"--dns-port\", options.dnsPort.toString());\n        if (options.torPort) args.push(\"--tor-port\", options.torPort.toString());\n        if (options.https) {\n            args.push(\"--https\");\n            if (options.httpsPort) args.push(\"--https-port\", options.httpsPort.toString());\n        }\n\n        // Pass proxy if detected\n        const env: { [key: string]: string | undefined } = { ...process.env };\n        if (network.proxy) {\n            // Rust crates often respect HTTPS_PROXY / ALL_PROXY\n            env.HTTPS_PROXY = network.proxy;\n            env.ALL_PROXY = network.proxy;\n            console.log(`   ‚Ä¢ Network proxy detected: ${network.proxy}`);\n        }\n\n        // Performance\n        if (options.cache === false) args.push(\"--cache\", \"false\");\n        if (options.cacheSize) args.push(\"--cache-size\", options.cacheSize.toString());\n        if (options.cacheTtl) args.push(\"--cache-ttl\", options.cacheTtl.toString());\n        if (options.geoPrefer) args.push(\"--geo-prefer\", options.geoPrefer);\n        if (options.prebuildCircuits) args.push(\"--prebuild-circuits\", options.prebuildCircuits.toString());\n        if (options.noPrebuild) args.push(\"--no-prebuild\");\n\n        // Log verbosity\n        env.RUST_LOG = options.verbose ? \"debug\" : \"info\";\n\n        this.daemon = spawn(daemonPath, args, {\n            stdio: [\"ignore\", \"pipe\", \"pipe\"],\n            env\n        });\n\n        // Handle daemon output if needed (TODO: stream to logger)\n        if (this.daemon.stderr) {\n            this.daemon.stderr.on('data', (data) => {\n                // Optional: Parse logs for \"Ready\" state\n            });\n        }\n\n        return this.daemon;\n    }\n\n    public stop() {\n        if (this.daemon) {\n            this.daemon.kill(\"SIGTERM\");\n            this.daemon = null;\n        }\n    }\n}\n","import https from 'https';\nimport http from 'http';\nimport { exec } from 'child_process';\nimport util from 'util';\nimport dgram from 'dgram';\n\n\nexport interface NetworkStatus {\n    hasInternet: boolean;\n    proxy?: string;\n    udpBlocked: boolean;\n    publicIp?: string;\n}\n\nexport class NetworkManager {\n    private static instance: NetworkManager;\n\n    private constructor() { }\n\n    static getInstance(): NetworkManager {\n        if (!NetworkManager.instance) {\n            NetworkManager.instance = new NetworkManager();\n        }\n        return NetworkManager.instance;\n    }\n\n    async analyze(): Promise<NetworkStatus> {\n        const [hasInternet, proxy, udpBlocked] = await Promise.all([\n            this.checkInternet(),\n            this.detectProxy(),\n            this.checkUDPBlocked()\n        ]);\n\n        return {\n            hasInternet,\n            proxy,\n            udpBlocked\n        };\n    }\n\n    private async checkInternet(): Promise<boolean> {\n        return new Promise((resolve) => {\n            const req = https.request('https://1.1.1.1', { method: 'HEAD', timeout: 3000 }, (res) => {\n                resolve(true);\n            });\n\n            req.on('error', () => resolve(false));\n            req.on('timeout', () => {\n                req.destroy();\n                resolve(false);\n            });\n\n            req.end();\n        });\n    }\n\n    private async detectProxy(): Promise<string | undefined> {\n        // 1. Check Environment Variables\n        const envProxy = process.env.HTTPS_PROXY || process.env.https_proxy || process.env.HTTP_PROXY || process.env.http_proxy || process.env.ALL_PROXY || process.env.all_proxy;\n        if (envProxy) return envProxy;\n\n        // 2. Check System Settings (platform specific)\n        try {\n            if (process.platform === 'darwin') {\n                const execAsync = util.promisify(exec);\n                const { stdout } = await execAsync('scutil --proxy');\n                // Parse stdout for HTTPEnable : 1 and HTTPProxy : <host>\n                if (stdout.includes('HTTPEnable : 1')) {\n                    const match = stdout.match(/HTTPProxy : ([^\\s]+)/);\n                    const portMatch = stdout.match(/HTTPPort : (\\d+)/);\n                    if (match && portMatch) {\n                        return `http://${match[1]}:${portMatch[1]}`;\n                    }\n                }\n            }\n            // Add Windows/Linux checks if needed\n        } catch { }\n\n        return undefined;\n    }\n\n    private async checkUDPBlocked(): Promise<boolean> {\n        // Attempt to resolve a domain using Google DNS (8.8.8.8) over UDP port 53\n        return new Promise((resolve) => {\n            const socket = dgram.createSocket('udp4');\n\n            // Simple DNS Query for google.com (Transaction ID: 1234, Flags: 0100 (Standard Query))\n            const query = Buffer.from([\n                0x12, 0x34, 0x01, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,\n                0x06, 0x67, 0x6f, 0x6f, 0x67, 0x6c, 0x65, 0x03, 0x63, 0x6f, 0x6d, 0x00,\n                0x00, 0x01, 0x00, 0x01\n            ]);\n\n            let responded = false;\n\n            socket.on('message', () => {\n                responded = true;\n                socket.close();\n                resolve(false); // UDP is working (NOT blocked)\n            });\n\n            socket.on('error', () => {\n                socket.close();\n                resolve(true); // Error implies blocked or failed\n            });\n\n            socket.send(query, 53, '8.8.8.8', (err) => {\n                if (err) {\n                    socket.close();\n                    resolve(true);\n                }\n            });\n\n            setTimeout(() => {\n                if (!responded) {\n                    socket.close();\n                    resolve(true); // Timeout implies blocked\n                }\n            }, 2000);\n        });\n    }\n}\n","import { execSync, spawn } from 'child_process';\nimport os from 'os';\nimport fs from 'fs';\nimport path from 'path';\nimport { NetworkManager } from './network-manager';\nimport { HostsManager } from './hosts-manager';\n\nexport interface DNSConfig {\n  mode: 'hosts' | 'system' | 'manual';\n  primary?: string;\n  secondary?: string;\n}\n\nexport class BeamDNSManager {\n  private configPath: string;\n  private configDir: string;\n  private hostsManager: HostsManager;\n\n  constructor() {\n    this.configDir = path.join(os.homedir(), '.beam');\n    this.configPath = path.join(this.configDir, 'dns-config.json');\n    this.hostsManager = new HostsManager();\n\n    if (!fs.existsSync(this.configDir)) {\n      fs.mkdirSync(this.configDir, { recursive: true });\n    }\n  }\n\n  async isBeamConfigured(): Promise<boolean> {\n    // Check if we have write access to hosts file (proxy for \"configured\")\n    // Or check if we previously saved a successful config\n    return await this.hostsManager.checkPermissions();\n  }\n\n  getPlatformName(): string {\n    const platform = os.platform();\n    switch (platform) {\n      case 'darwin': return 'macOS';\n      case 'win32': return 'Windows';\n      case 'linux': return 'Linux';\n      default: return platform;\n    }\n  }\n\n  needsPrivileges(platform: string): boolean {\n    // We try to avoid privileges, but if we need them for hosts file:\n    // Windows usually needs Admin for hosts. Mac/Linux usually needs sudo.\n    // But we'll return false here to try the \"non-invasive\" path first, \n    // and let configureForDomain fail/warn if needed.\n    // Actually, returning true here triggers \"Run with sudo\" prompt in index.ts which is helpful.\n    // Let's check strict permissions.\n    try {\n      fs.accessSync(this.hostsManager['hostsPath'], fs.constants.W_OK);\n      return false;\n    } catch {\n      return true;\n    }\n  }\n\n  async testInternetConnectivity(): Promise<boolean> {\n    const status = await NetworkManager.getInstance().analyze();\n    return status.hasInternet;\n  }\n\n  async configureBeamDNS(): Promise<boolean> {\n    // This is called by \"Global Setup\".\n    // Since we moved to per-domain (Hosts), there isn't really a \"Global\" state \n    // other than having permissions.\n    // We basically just verify we can modify the system.\n    const hasAccess = await this.hostsManager.checkPermissions();\n    if (hasAccess) {\n      return true;\n    }\n    return false;\n  }\n\n  showManualInstructions(): void {\n    console.log('üîß Manual Setup');\n    console.log('================');\n    console.log('Add your domains to your hosts file:');\n    if (os.platform() === 'win32') {\n      console.log('C:\\\\Windows\\\\System32\\\\drivers\\\\etc\\\\hosts');\n    } else {\n      console.log('/etc/hosts');\n    }\n    console.log('Entry: 127.0.0.1 <your-domain>.beam # beam-tunnel');\n  }\n\n  async configureForDomain(domain: string): Promise<boolean> {\n    console.log(`   ‚Ä¢ Configuring DNS for ${domain}...`);\n\n    // 1. Try Hosts File (Least Intrusive, Most Robust for single domain)\n    const hasWriteAccess = await this.hostsManager.checkPermissions();\n    if (hasWriteAccess) {\n      const success = await this.hostsManager.addDomain(domain);\n      if (success) {\n        console.log(`   ‚úÖ Added ${domain} to hosts file.`);\n        return true;\n      }\n    } else {\n      // Try to sudo if interactive? Or just warn.\n      console.log('   ‚ö†Ô∏è  No write access to hosts file (try running with sudo).');\n    }\n\n    // 2. Fallback: Check if we can use a local proxy or system DNS\n    // For now, we mainly rely on hosts file for specific domains as it's the safest \"universal\" method\n\n    // 3. Manual Instructions\n    if (!hasWriteAccess) {\n      console.log('   ‚ùå Automatic setup failed due to permissions.');\n      console.log(`   üí° Please add this line to your hosts file manually:`);\n      console.log(`      127.0.0.1 ${domain} # beam-tunnel`);\n    }\n\n    return false;\n  }\n\n  async cleanup(domain?: string): Promise<void> {\n    if (domain) {\n      await this.hostsManager.removeDomain(domain);\n    }\n    // Also cleanup system DNS if we ever messed with it (legacy support)\n    // await this.restoreSystemDNS(); \n  }\n\n  // ... (Keep legacy system DNS methods for \"Global Mode\" later if needed)\n}\n","import fs from 'fs';\nimport os from 'os';\nimport path from 'path';\n\nexport class HostsManager {\n    private hostsPath: string;\n\n    constructor() {\n        this.hostsPath = process.platform === 'win32'\n            ? path.join('C:', 'Windows', 'System32', 'drivers', 'etc', 'hosts')\n            : '/etc/hosts';\n    }\n\n    /**\n     * Add a domain to the hosts file pointing to 127.0.0.1\n     * Returns true if successful, false if permission denied/error\n     */\n    async addDomain(domain: string): Promise<boolean> {\n        try {\n            const content = await this.readHosts();\n            if (this.hasDomain(content, domain)) {\n                return true; // Already exists\n            }\n\n            const newEntry = `\\n127.0.0.1 ${domain} # beam-tunnel\\n`;\n            await fs.promises.appendFile(this.hostsPath, newEntry);\n            return true;\n        } catch (error) {\n            return false;\n        }\n    }\n\n    /**\n     * Remove a domain from the hosts file\n     */\n    async removeDomain(domain: string): Promise<boolean> {\n        try {\n            let content = await this.readHosts();\n            if (!this.hasDomain(content, domain)) {\n                return true;\n            }\n\n            // Regex to remove the line: 127.0.0.1 domain # beam-tunnel\n            const regex = new RegExp(`^.*${domain}.*# beam-tunnel.*$`, 'gm');\n            content = content.replace(regex, '');\n\n            // Clean up multiple newlines\n            content = content.replace(/\\n\\s*\\n/g, '\\n');\n\n            await fs.promises.writeFile(this.hostsPath, content.trim() + '\\n');\n            return true;\n        } catch (error) {\n            return false;\n        }\n    }\n\n    /**\n      * Check if we have write access to hosts file\n      */\n    async checkPermissions(): Promise<boolean> {\n        try {\n            await fs.promises.access(this.hostsPath, fs.constants.W_OK);\n            return true;\n        } catch {\n            return false;\n        }\n    }\n\n    private async readHosts(): Promise<string> {\n        return fs.promises.readFile(this.hostsPath, 'utf8');\n    }\n\n    private hasDomain(content: string, domain: string): boolean {\n        return content.includes(domain) && content.includes('# beam-tunnel');\n    }\n}\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA,oBACA,8BAEA,aACAA,uBAaa;AAjBb;AAAA;AAAA;AAAA,qBAAoB;AACpB,mCAAsC;AAEtC,kBAAiB;AACjB,IAAAA,wBAAsB;AAaf,IAAM,gBAAN,MAAoB;AAAA,MAKvB,YAAoB,SAA+B;AAA/B;AAChB,aAAK,UAAM,eAAAC,SAAQ;AAGnB,aAAK,IAAI,IAAI,CAAC,KAAK,KAAK,SAAS;AAC7B,cAAI,OAAO,+BAA+B,GAAG;AAC7C,cAAI,OAAO,gCAAgC,iCAAiC;AAC5E,cAAI,OAAO,gCAAgC,+DAA+D;AAC1G,cAAI,IAAI,WAAW,WAAW;AAC1B,gBAAI,WAAW,GAAG;AAAA,UACtB,OAAO;AACH,iBAAK;AAAA,UACT;AAAA,QACJ,CAAC;AAGD,aAAK,IAAI,IAAI,SAAK,oDAAsB;AAAA,UACpC,QAAQ,oBAAoB,QAAQ,SAAS;AAAA,UAC7C,cAAc;AAAA,UACd,IAAI;AAAA;AAAA,UACJ,SAAS,CAAC,KAAK,KAAK,QAAQ;AACxB,oBAAQ,MAAM,gBAAgB,GAAG;AACjC,gBAAI,OAAO,GAAG,EAAE,KAAK,oBAAoB;AAAA,UAC7C;AAAA,QACJ,CAAC,CAAC;AAAA,MACN;AAAA,MA7BQ;AAAA,MACA,SAA4C;AAAA,MAC5C,gBAAqB;AAAA,MA6B7B,MAAM,cAA+B;AACjC,eAAO,IAAI,QAAQ,CAAC,SAAS,WAAW;AACpC,cAAI;AAEA,oBAAQ,IAAI,sCAA+B;AAGvD,kBAAM,UAAU,KAAK,QAAQ,iBAAiB;AAC9C,gBAAI;AACJ,gBAAI;AAEJ,oBAAQ,SAAS;AAAA,cACf,KAAK;AACH,2BAAW;AACX,0BAAU,CAAC,QAAQ,KAAK,QAAQ,UAAU,SAAS,CAAC;AACpD;AAAA,cACF,KAAK;AACH,2BAAW;AACX,0BAAU,CAAC,MAAM,gBAAgB,KAAK,QAAQ,SAAS,IAAI,YAAY;AACvE;AAAA,cACF,KAAK;AACH,2BAAW;AACX,0BAAU,CAAC,UAAU,SAAS,oBAAoB,KAAK,QAAQ,SAAS,EAAE;AAC1E;AAAA,cACF,KAAK;AAAA,cACL;AACE,2BAAW;AACX,0BAAU;AAAA,kBACR;AAAA,kBACA;AAAA,kBAAU,KAAK,QAAQ,UAAU,SAAS;AAAA,kBAC1C;AAAA,kBAAe,KAAK,QAAQ,gBAAgB,QAAQ,KAAK,IAAI,CAAC;AAAA,gBAChE;AACA;AAAA,YACJ;AAEA,iBAAK,oBAAgB,6BAAM,UAAU,SAAS;AAAA,cAC9B,OAAO,CAAC,QAAQ,QAAQ,MAAM;AAAA,YAClC,CAAC;AAED,gBAAI,YAAY;AAChB,gBAAI,UAAU;AAEd,iBAAK,cAAc,OAAO,GAAG,QAAQ,CAAC,SAAiB;AACnD,oBAAM,SAAS,KAAK,SAAS;AAC7B,sBAAQ,IAAI,WAAW,OAAO,KAAK,CAAC;AAGpC,oBAAM,WAAW,OAAO,MAAM,kBAAkB;AAChD,kBAAI,YAAY,CAAC,SAAS;AACtB,4BAAY,SAAS,CAAC;AACtB,0BAAU;AACV,wBAAQ,IAAI,0BAAmB,SAAS,EAAE;AAC1C,wBAAQ,SAAS;AAAA,cACrB;AAAA,YACJ,CAAC;AAED,iBAAK,cAAc,OAAO,GAAG,QAAQ,CAAC,SAAiB;AACnD,sBAAQ,MAAM,iBAAiB,KAAK,SAAS,CAAC;AAAA,YAClD,CAAC;AAED,iBAAK,cAAc,GAAG,SAAS,CAAC,SAAiB;AAC7C,kBAAI,SAAS,GAAG;AACZ,uBAAO,IAAI,MAAM,mCAAmC,IAAI,EAAE,CAAC;AAAA,cAC/D;AAAA,YACJ,CAAC;AAGD,uBAAW,MAAM;AACb,kBAAI,CAAC,SAAS;AACV,uBAAO,IAAI,MAAM,qCAAqC,CAAC;AAAA,cAC3D;AAAA,YACJ,GAAG,GAAK;AAAA,UAEZ,SAAS,OAAO;AACZ,mBAAO,KAAK;AAAA,UAChB;AAAA,QACJ,CAAC;AAAA,MACL;AAAA,MAEA,mBAAyB;AAErB,cAAM,eAAe;AAAA;AAAA,UAEjB,KAAK;AAAA,UACL,MAAM;AAAA,QACV;AAEA,aAAK,SAAS,YAAAC,QAAK,aAAa,KAAK,GAAG;AACxC,aAAK,OAAO,OAAO,KAAK,QAAQ,WAAW,MAAM;AAC7C,kBAAQ,IAAI,kDAA2C,KAAK,QAAQ,SAAS,EAAE;AAAA,QACnF,CAAC;AAAA,MACL;AAAA,MAEA,OAAa;AACT,YAAI,KAAK,QAAQ;AACb,eAAK,OAAO,MAAM;AAAA,QACtB;AACA,YAAI,KAAK,eAAe;AACpB,eAAK,cAAc,KAAK;AAAA,QAC5B;AAAA,MACJ;AAAA,IACJ;AAAA;AAAA;;;ACtJA;AAAA;AAAA;AAAA;AAAA,IACA,gBAGa;AAJb;AAAA;AAAA;AACA,qBAAmB;AAGZ,IAAM,kBAAN,MAAsB;AAAA,MACjB;AAAA,MACA,cAA2B,oBAAI,IAAI;AAAA,MAE3C,cAAc;AACV,aAAK,SAAS,IAAI,eAAAC,QAAO;AAAA,MAC7B;AAAA;AAAA;AAAA;AAAA,MAKA,MAAM,QAAQ,YAAoB,aAAuC;AACrE,eAAO,IAAI,QAAQ,CAAC,YAAY;AAC5B,eAAK,OAAO,IAAI,YAAY,aAAa,CAAC,QAAQ;AAC9C,gBAAI,KAAK;AACL,sBAAQ,MAAM,gCAA2B,UAAU,KAAK,IAAI,OAAO;AACnE,sBAAQ,KAAK;AAAA,YACjB,OAAO;AACH,sBAAQ,IAAI,kCAA6B,UAAU,kBAAa,WAAW,EAAE;AAC7E,mBAAK,YAAY,IAAI,UAAU;AAC/B,sBAAQ,IAAI;AAAA,YAChB;AAAA,UACJ,CAAC;AAAA,QACL,CAAC;AAAA,MACL;AAAA;AAAA;AAAA;AAAA,MAKA,MAAM,UAAU,YAAmC;AAC/C,eAAO,IAAI,QAAQ,CAAC,YAAY;AAC5B,eAAK,OAAO,MAAM,YAAY,CAAC,QAAQ;AACnC,gBAAI,KAAK;AAAA,YAET,OAAO;AACH,sBAAQ,IAAI,gCAAyB,UAAU,EAAE;AAAA,YACrD;AACA,iBAAK,YAAY,OAAO,UAAU;AAClC,oBAAQ;AAAA,UACZ,CAAC;AAAA,QACL,CAAC;AAAA,MACL;AAAA;AAAA;AAAA;AAAA,MAKA,MAAM,cAAsC;AACxC,eAAO,IAAI,QAAQ,CAAC,YAAY;AAC5B,eAAK,OAAO,WAAW,CAAC,KAAK,OAAO;AAChC,gBAAI,KAAK;AACL,sBAAQ,IAAI;AAAA,YAChB,OAAO;AACH,sBAAQ,EAAE;AAAA,YACd;AAAA,UACJ,CAAC;AAAA,QACL,CAAC;AAAA,MACL;AAAA;AAAA;AAAA;AAAA,MAKA,MAAM,UAAyB;AAC3B,YAAI,KAAK,YAAY,SAAS,EAAG;AAEjC,gBAAQ,IAAI,+CAAwC;AACpD,cAAM,WAAW,MAAM,KAAK,KAAK,WAAW,EAAE,IAAI,UAAQ,KAAK,UAAU,IAAI,CAAC;AAC9E,cAAM,QAAQ,IAAI,QAAQ;AAAA,MAC9B;AAAA,IACJ;AAAA;AAAA;;;ACxEA;AAAA;AAAA;AAAA;AAAA,IACA,mBACA,mBACAC,eACAC,cACAC,YAEa;AAPb;AAAA;AAAA;AACA,wBAAuB;AACvB,wBAAsB;AACtB,IAAAF,gBAAkB;AAClB,IAAAC,eAAiB;AACjB,IAAAC,aAAe;AAER,IAAM,aAAN,MAAiB;AAAA,MACZ;AAAA,MACA,SAA8B;AAAA,MAC9B,aAAqB;AAAA,MAE7B,cAAc;AACV,aAAK,QAAQ,kBAAAC,QAAU,kBAAkB,CAAC,CAAC;AAG3C,aAAK,MAAM,GAAG,SAAS,CAAC,KAAK,KAAK,QAAQ;AACtC,gBAAM,SAAS;AACf,cAAI,OAAO,YAAa;AAExB,cAAI,eAAe,aAAAC,QAAK,gBAAgB;AACpC,gBAAI,UAAU,GAAG;AACjB,gBAAI,IAAI,oBAAoB,IAAI,OAAO;AAAA,UAC3C;AAAA,QACJ,CAAC;AAAA,MACL;AAAA;AAAA;AAAA;AAAA,MAKA,MAAM,MAAM,YAAoB,qBAA8B,UAAgF;AAC1I,gBAAQ,IAAI,oDAA6C;AAGzD,cAAM,QAAQ,CAAC,EAAE,MAAM,cAAc,OAAO,YAAY,CAAC;AAKzD,cAAM,aAAa,WAAAC,QAAG,kBAAkB;AACxC,cAAM,MAAM,CAAC,aAAa,WAAW;AACrC,mBAAW,QAAQ,OAAO,KAAK,UAAU,GAAG;AACxC,qBAAW,SAAS,WAAW,IAAI,KAAK,CAAC,GAAG;AACxC,gBAAI,MAAM,WAAW,UAAU,CAAC,MAAM,UAAU;AAC5C,kBAAI,KAAK,MAAM,OAAO;AAAA,YAC1B;AAAA,UACJ;AAAA,QACJ;AAIA,YAAI,YAAY,CAAC,IAAI,SAAS,QAAQ,GAAG;AACrC,cAAI,KAAK,QAAQ;AAAA,QACrB;AAEA,cAAM,WAAW,IAAI,IAAI,SAAO,EAAE,MAAM,GAAG,GAAO,EAAE;AAOpD,cAAM,aAAa;AAAA,UACf,EAAE,MAAM,oBAAoB,IAAI,KAAK;AAAA,UACrC;AAAA,YACI,MAAM;AAAA,YACN;AAAA,UACJ;AAAA,QACJ;AAEA,YAAI;AACJ,YAAI,eAAe,YAAY;AAC/B,YAAI,YAAY;AAIhB,YAAI;AAIA,gBAAM,EAAE,eAAe,IAAI,MAAM,OAAO,SAAS;AAKjD,cAAI,eAAyB,CAAC;AAC9B,cAAI,UAAU;AACV,yBAAa,KAAK,GAAG,QAAQ,SAAS;AACtC,yBAAa,KAAK,GAAG,QAAQ,WAAW;AAAA,UAC5C,OAAO;AACH,yBAAa,KAAK,WAAW;AAAA,UACjC;AAGA,cAAI,CAAC,YAAY,aAAa,aAAa;AACvC,yBAAa,KAAK,QAAQ;AAAA,UAC9B;AAEA,cAAI;AACJ,qBAAW,UAAU,cAAc;AAC/B,gBAAI;AACA,sBAAQ,IAAI,+DAAwD,MAAM,KAAK;AAC/E,qBAAO,MAAM,eAAe,QAAQ,EAAE,qBAAqB,OAAO,eAAe,KAAK,CAAC;AACvF,6BAAe;AACf,0BAAY;AACZ,sBAAQ,IAAI,+CAA0C,YAAY,GAAG;AACrE;AAAA,YACJ,SAAS,KAAK;AACV,sBAAQ,IAAI,2CAAiC,MAAM,kBAAkB;AACrE,0BAAY;AAAA,YAEhB;AAAA,UACJ;AAEA,cAAI,CAAC,WAAW;AACZ,kBAAM,aAAa,IAAI,MAAM,qCAAqC;AAAA,UACtE;AAAA,QAIJ,SAAS,cAAc;AACnB,kBAAQ,IAAI,6EAAmE;AAS/E,cAAI,SAAU,gBAAe;AAC7B,sBAAY;AAEZ,cAAI;AAEA,mBAAO,MAAM,kBAAAC,QAAW,SAAS,OAAO;AAAA,cACpC,SAAS;AAAA,cACT,WAAW;AAAA;AAAA,cAEX;AAAA,YACJ,CAAC;AAAA,UACL,SAAS,OAAO;AACZ,kBAAM;AAAA,UACV;AAAA,QACJ;AAEA,cAAM,UAAU;AAAA,UACZ,KAAK,KAAK,OAAO,KAAK;AAAA;AAAA,UACtB,MAAM,KAAK;AAAA,QACf;AAEA,eAAO,IAAI,QAAQ,CAAC,SAAS,WAAW;AACpC,eAAK,SAAS,cAAAC,QAAM,aAAa,SAAS,CAAC,KAAK,QAAQ;AACpD,iBAAK,MAAM,IAAI,KAAK,KAAK,EAAE,QAAQ,oBAAoB,UAAU,GAAG,GAAG,CAAC,QAAQ;AAE5E,kBAAI,CAAC,IAAI,aAAa;AAClB,oBAAI,UAAU,GAAG;AACjB,oBAAI,IAAI,aAAa;AAAA,cACzB;AAAA,YACJ,CAAC;AAAA,UACL,CAAC;AAMD,gBAAM,OAAO,uBAAuB;AAEpC,eAAK,OAAO,OAAO,MAAM,WAAW,MAAM;AACtC,kBAAM,UAAU,KAAK,QAAQ,QAAQ;AACrC,gBAAI,WAAW,OAAO,YAAY,UAAU;AACxC,mBAAK,aAAa,QAAQ;AAC1B,sBAAQ,EAAE,MAAM,KAAK,YAAY,QAAQ,cAAc,SAAS,UAAU,CAAC;AAAA,YAC/E,OAAO;AACH,qBAAO,IAAI,MAAM,0BAA0B,CAAC;AAAA,YAChD;AAAA,UACJ,CAAC;AAED,eAAK,OAAO,GAAG,SAAS,CAAC,QAAQ;AAC7B,mBAAO,GAAG;AAAA,UACd,CAAC;AAAA,QACL,CAAC;AAAA,MACL;AAAA,MAEA,OAAO;AACH,YAAI,KAAK,QAAQ;AACb,eAAK,OAAO,MAAM;AAClB,eAAK,SAAS;AAAA,QAClB;AACA,aAAK,MAAM,MAAM;AAAA,MACrB;AAAA,IACJ;AAAA;AAAA;;;AC/LA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA,uBAAwB;AACxB,IAAAC,wBAA8C;AAC9C,IAAAC,aAAe;AACf,IAAAC,aAAe;AACf,IAAAC,eAAiB;AACjB,IAAAC,eAAiB;;;ACNjB,IAAAC,wBAAoC;AACpC,kBAAiB;AACjB,gBAAe;AACf,gBAAe;AACf,IAAAC,gBAAkB;;;ACJlB,mBAAkB;AAElB,2BAAqB;AACrB,kBAAiB;AACjB,mBAAkB;AAUX,IAAM,iBAAN,MAAM,gBAAe;AAAA,EACxB,OAAe;AAAA,EAEP,cAAc;AAAA,EAAE;AAAA,EAExB,OAAO,cAA8B;AACjC,QAAI,CAAC,gBAAe,UAAU;AAC1B,sBAAe,WAAW,IAAI,gBAAe;AAAA,IACjD;AACA,WAAO,gBAAe;AAAA,EAC1B;AAAA,EAEA,MAAM,UAAkC;AACpC,UAAM,CAAC,aAAa,OAAO,UAAU,IAAI,MAAM,QAAQ,IAAI;AAAA,MACvD,KAAK,cAAc;AAAA,MACnB,KAAK,YAAY;AAAA,MACjB,KAAK,gBAAgB;AAAA,IACzB,CAAC;AAED,WAAO;AAAA,MACH;AAAA,MACA;AAAA,MACA;AAAA,IACJ;AAAA,EACJ;AAAA,EAEA,MAAc,gBAAkC;AAC5C,WAAO,IAAI,QAAQ,CAAC,YAAY;AAC5B,YAAM,MAAM,aAAAC,QAAM,QAAQ,mBAAmB,EAAE,QAAQ,QAAQ,SAAS,IAAK,GAAG,CAAC,QAAQ;AACrF,gBAAQ,IAAI;AAAA,MAChB,CAAC;AAED,UAAI,GAAG,SAAS,MAAM,QAAQ,KAAK,CAAC;AACpC,UAAI,GAAG,WAAW,MAAM;AACpB,YAAI,QAAQ;AACZ,gBAAQ,KAAK;AAAA,MACjB,CAAC;AAED,UAAI,IAAI;AAAA,IACZ,CAAC;AAAA,EACL;AAAA,EAEA,MAAc,cAA2C;AAErD,UAAM,WAAW,QAAQ,IAAI,eAAe,QAAQ,IAAI,eAAe,QAAQ,IAAI,cAAc,QAAQ,IAAI,cAAc,QAAQ,IAAI,aAAa,QAAQ,IAAI;AAChK,QAAI,SAAU,QAAO;AAGrB,QAAI;AACA,UAAI,QAAQ,aAAa,UAAU;AAC/B,cAAM,YAAY,YAAAC,QAAK,UAAU,yBAAI;AACrC,cAAM,EAAE,OAAO,IAAI,MAAM,UAAU,gBAAgB;AAEnD,YAAI,OAAO,SAAS,gBAAgB,GAAG;AACnC,gBAAM,QAAQ,OAAO,MAAM,sBAAsB;AACjD,gBAAM,YAAY,OAAO,MAAM,kBAAkB;AACjD,cAAI,SAAS,WAAW;AACpB,mBAAO,UAAU,MAAM,CAAC,CAAC,IAAI,UAAU,CAAC,CAAC;AAAA,UAC7C;AAAA,QACJ;AAAA,MACJ;AAAA,IAEJ,QAAQ;AAAA,IAAE;AAEV,WAAO;AAAA,EACX;AAAA,EAEA,MAAc,kBAAoC;AAE9C,WAAO,IAAI,QAAQ,CAAC,YAAY;AAC5B,YAAM,SAAS,aAAAC,QAAM,aAAa,MAAM;AAGxC,YAAM,QAAQ,OAAO,KAAK;AAAA,QACtB;AAAA,QAAM;AAAA,QAAM;AAAA,QAAM;AAAA,QAAM;AAAA,QAAM;AAAA,QAAM;AAAA,QAAM;AAAA,QAAM;AAAA,QAAM;AAAA,QAAM;AAAA,QAAM;AAAA,QAClE;AAAA,QAAM;AAAA,QAAM;AAAA,QAAM;AAAA,QAAM;AAAA,QAAM;AAAA,QAAM;AAAA,QAAM;AAAA,QAAM;AAAA,QAAM;AAAA,QAAM;AAAA,QAAM;AAAA,QAClE;AAAA,QAAM;AAAA,QAAM;AAAA,QAAM;AAAA,MACtB,CAAC;AAED,UAAI,YAAY;AAEhB,aAAO,GAAG,WAAW,MAAM;AACvB,oBAAY;AACZ,eAAO,MAAM;AACb,gBAAQ,KAAK;AAAA,MACjB,CAAC;AAED,aAAO,GAAG,SAAS,MAAM;AACrB,eAAO,MAAM;AACb,gBAAQ,IAAI;AAAA,MAChB,CAAC;AAED,aAAO,KAAK,OAAO,IAAI,WAAW,CAAC,QAAQ;AACvC,YAAI,KAAK;AACL,iBAAO,MAAM;AACb,kBAAQ,IAAI;AAAA,QAChB;AAAA,MACJ,CAAC;AAED,iBAAW,MAAM;AACb,YAAI,CAAC,WAAW;AACZ,iBAAO,MAAM;AACb,kBAAQ,IAAI;AAAA,QAChB;AAAA,MACJ,GAAG,GAAI;AAAA,IACX,CAAC;AAAA,EACL;AACJ;;;AD9FO,IAAM,gBAAN,MAAoB;AAAA,EACf,SAA8B;AAAA,EAC9B;AAAA,EACS,iBAAiB;AAAA;AAAA,EACjB,aAAa;AAAA,EACb,YAAY;AAAA,EAE7B,YAAY,aAAsB;AAC9B,SAAK,cAAc,eAAe,KAAK,gBAAgB;AAAA,EAC3D;AAAA,EAEQ,kBAA0B;AAC9B,QAAI;AACA,UAAI,UAAU,QAAQ,IAAI;AAC1B,YAAM,OAAO,YAAAC,QAAK,MAAM,OAAO,EAAE;AAEjC,aAAO,YAAY,MAAM;AACrB,YAAI,UAAAC,QAAG,WAAW,YAAAD,QAAK,KAAK,SAAS,cAAc,CAAC,GAAG;AACnD,gBAAM,UAAU,YAAAA,QAAK,KAAK,SAAS,cAAc;AACjD,cAAI;AACA,kBAAM,MAAM,KAAK,MAAM,UAAAC,QAAG,aAAa,SAAS,MAAM,CAAC;AAEvD,gBAAI,IAAI,SAAS,qBAAqB,UAAAA,QAAG,WAAW,YAAAD,QAAK,KAAK,SAAS,YAAY,eAAe,CAAC,GAAG;AAClG,qBAAO;AAAA,YACX;AAAA,UACJ,SAAS,GAAG;AAAA,UAEZ;AAAA,QACJ;AACA,kBAAU,YAAAA,QAAK,QAAQ,OAAO;AAAA,MAClC;AAAA,IACJ,QAAQ;AAAA,IAER;AACA,WAAO,QAAQ,IAAI;AAAA,EACvB;AAAA,EAEQ,cAAsB;AAC1B,UAAM,OAAO,UAAAE,QAAG,QAAQ;AACxB,UAAM,WAAW,YAAAF,QAAK,KAAK,MAAM,SAAS,KAAK;AAC/C,QAAI,CAAC,UAAAC,QAAG,WAAW,QAAQ,GAAG;AAC1B,gBAAAA,QAAG,UAAU,UAAU,EAAE,WAAW,KAAK,CAAC;AAAA,IAC9C;AACA,WAAO;AAAA,EACX;AAAA,EAEQ,oBAA4B;AAChC,UAAM,WAAW,UAAAC,QAAG,SAAS;AAC7B,UAAM,OAAO,UAAAA,QAAG,KAAK;AAErB,QAAI,SAAS;AACb,YAAQ,UAAU;AAAA,MACd,KAAK;AAAU,iBAAS;AAAgB;AAAA,MACxC,KAAK;AAAS,iBAAS;AAAqB;AAAA,MAC5C,KAAK;AAAS,iBAAS;AAAmB;AAAA,MAC1C;AAAS,cAAM,IAAI,MAAM,yBAAyB,QAAQ,EAAE;AAAA,IAChE;AAEA,QAAI,WAAW;AACf,YAAQ,MAAM;AAAA,MACV,KAAK;AAAO,mBAAW;AAAU;AAAA,MACjC,KAAK;AAAS,mBAAW;AAAW;AAAA,MACpC;AAAS,cAAM,IAAI,MAAM,6BAA6B,IAAI,EAAE;AAAA,IAChE;AAEA,UAAM,MAAM,aAAa,UAAU,SAAS;AAC5C,WAAO,sBAAsB,QAAQ,IAAI,MAAM,GAAG,GAAG;AAAA,EACzD;AAAA,EAEQ,gBAAwB;AAE5B,UAAM,eAAe,YAAAF,QAAK,KAAK,KAAK,aAAa,0DAA0D;AAC3G,QAAI,UAAAC,QAAG,WAAW,YAAY,GAAG;AAC7B,aAAO;AAAA,IACX;AAGA,UAAM,WAAW,KAAK,kBAAkB;AACxC,WAAO,YAAAD,QAAK,KAAK,KAAK,YAAY,GAAG,QAAQ;AAAA,EACjD;AAAA,EAEA,MAAc,wBAAyC;AACnD,UAAM,aAAa,KAAK,cAAc;AAEtC,QAAI,UAAAC,QAAG,WAAW,UAAU,GAAG;AAE3B,UAAI;AACA,kBAAAA,QAAG,WAAW,YAAY,UAAAA,QAAG,UAAU,IAAI;AAAA,MAC/C,QAAQ;AACJ,cAAM,UAAAA,QAAG,SAAS,MAAM,YAAY,GAAK;AAAA,MAC7C;AACA,aAAO;AAAA,IACX;AAGA,YAAQ,IAAI,2DAAsD;AAClE,QAAI;AACA,YAAM,KAAK,eAAe,UAAU;AACpC,cAAQ,IAAI,2CAAsC;AAClD,YAAM,UAAAA,QAAG,SAAS,MAAM,YAAY,GAAK;AACzC,aAAO;AAAA,IACX,SAAS,OAAY;AACjB,YAAM,IAAI,MAAM,qCAAqC,MAAM,OAAO,EAAE;AAAA,IACxE;AAAA,EACJ;AAAA,EAEA,MAAc,eAAe,UAAiC;AAC1D,UAAM,WAAW,KAAK,kBAAkB;AACxC,UAAM,MAAM,sBAAsB,KAAK,UAAU,IAAI,KAAK,SAAS,uBAAuB,KAAK,cAAc,IAAI,QAAQ;AAEzH,WAAO,IAAI,QAAQ,CAAC,SAAS,WAAW;AACpC,YAAM,OAAO,UAAAA,QAAG,kBAAkB,QAAQ;AAC1C,oBAAAE,QAAM,IAAI,KAAK,CAAC,aAAa;AACzB,YAAI,SAAS,eAAe,OAAO,SAAS,eAAe,KAAK;AAE5D,gBAAM,cAAc,SAAS,QAAQ;AACrC,cAAI,CAAC,aAAa;AACd,mBAAO,IAAI,MAAM,2BAA2B,CAAC;AAC7C;AAAA,UACJ;AACA,wBAAAA,QAAM,IAAI,aAAa,CAAC,QAAQ;AAC5B,gBAAI,IAAI,eAAe,KAAK;AACxB,qBAAO,IAAI,MAAM,uBAAuB,IAAI,UAAU,EAAE,CAAC;AACzD;AAAA,YACJ;AACA,gBAAI,KAAK,IAAI;AACb,iBAAK,GAAG,UAAU,MAAM;AACpB,mBAAK,MAAM;AACX,sBAAQ;AAAA,YACZ,CAAC;AAAA,UACL,CAAC,EAAE,GAAG,SAAS,CAAC,QAAQ;AACpB,sBAAAF,QAAG,OAAO,UAAU,MAAM;AAAA,YAAE,CAAC;AAC7B,mBAAO,GAAG;AAAA,UACd,CAAC;AAAA,QACL,WAAW,SAAS,eAAe,KAAK;AACpC,mBAAS,KAAK,IAAI;AAClB,eAAK,GAAG,UAAU,MAAM;AACpB,iBAAK,MAAM;AACX,oBAAQ;AAAA,UACZ,CAAC;AAAA,QACL,OAAO;AACH,iBAAO,IAAI,MAAM,uBAAuB,SAAS,UAAU,EAAE,CAAC;AAAA,QAClE;AAAA,MACJ,CAAC,EAAE,GAAG,SAAS,CAAC,QAAQ;AACpB,kBAAAA,QAAG,OAAO,UAAU,MAAM;AAAA,QAAE,CAAC;AAC7B,eAAO,GAAG;AAAA,MACd,CAAC;AAAA,IACL,CAAC;AAAA,EACL;AAAA,EAEA,MAAa,MAAM,SAA+C;AAE9D,QAAI,KAAK,QAAQ;AACb,WAAK,KAAK;AAAA,IACd;AAEA,UAAM,aAAa,MAAM,KAAK,sBAAsB;AACpD,UAAM,UAAU,MAAM,eAAe,YAAY,EAAE,QAAQ;AAE3D,UAAM,OAAO;AAAA,MACT;AAAA,MAAiB,QAAQ,WAAW,SAAS;AAAA,MAC7C;AAAA,MAAY,QAAQ,UAAU,QAAQ,KAAK,IAAI,CAAC;AAAA,MAChD;AAAA,MAAU,QAAQ,QAAQ;AAAA,IAC9B;AAEA,QAAI,QAAQ,QAAS,MAAK,KAAK,cAAc,QAAQ,QAAQ,SAAS,CAAC;AACvE,QAAI,QAAQ,QAAS,MAAK,KAAK,cAAc,QAAQ,QAAQ,SAAS,CAAC;AACvE,QAAI,QAAQ,OAAO;AACf,WAAK,KAAK,SAAS;AACnB,UAAI,QAAQ,UAAW,MAAK,KAAK,gBAAgB,QAAQ,UAAU,SAAS,CAAC;AAAA,IACjF;AAGA,UAAM,MAA6C,EAAE,GAAG,QAAQ,IAAI;AACpE,QAAI,QAAQ,OAAO;AAEf,UAAI,cAAc,QAAQ;AAC1B,UAAI,YAAY,QAAQ;AACxB,cAAQ,IAAI,qCAAgC,QAAQ,KAAK,EAAE;AAAA,IAC/D;AAGA,QAAI,QAAQ,UAAU,MAAO,MAAK,KAAK,WAAW,OAAO;AACzD,QAAI,QAAQ,UAAW,MAAK,KAAK,gBAAgB,QAAQ,UAAU,SAAS,CAAC;AAC7E,QAAI,QAAQ,SAAU,MAAK,KAAK,eAAe,QAAQ,SAAS,SAAS,CAAC;AAC1E,QAAI,QAAQ,UAAW,MAAK,KAAK,gBAAgB,QAAQ,SAAS;AAClE,QAAI,QAAQ,iBAAkB,MAAK,KAAK,uBAAuB,QAAQ,iBAAiB,SAAS,CAAC;AAClG,QAAI,QAAQ,WAAY,MAAK,KAAK,eAAe;AAGjD,QAAI,WAAW,QAAQ,UAAU,UAAU;AAE3C,SAAK,aAAS,6BAAM,YAAY,MAAM;AAAA,MAClC,OAAO,CAAC,UAAU,QAAQ,MAAM;AAAA,MAChC;AAAA,IACJ,CAAC;AAGD,QAAI,KAAK,OAAO,QAAQ;AACpB,WAAK,OAAO,OAAO,GAAG,QAAQ,CAAC,SAAS;AAAA,MAExC,CAAC;AAAA,IACL;AAEA,WAAO,KAAK;AAAA,EAChB;AAAA,EAEO,OAAO;AACV,QAAI,KAAK,QAAQ;AACb,WAAK,OAAO,KAAK,SAAS;AAC1B,WAAK,SAAS;AAAA,IAClB;AAAA,EACJ;AACJ;;;AE/OA,IAAAG,aAAe;AACf,IAAAC,aAAe;AACf,IAAAC,eAAiB;;;ACHjB,IAAAC,aAAe;AAEf,IAAAC,eAAiB;AAEV,IAAM,eAAN,MAAmB;AAAA,EACd;AAAA,EAER,cAAc;AACV,SAAK,YAAY,QAAQ,aAAa,UAChC,aAAAC,QAAK,KAAK,MAAM,WAAW,YAAY,WAAW,OAAO,OAAO,IAChE;AAAA,EACV;AAAA;AAAA;AAAA;AAAA;AAAA,EAMA,MAAM,UAAU,QAAkC;AAC9C,QAAI;AACA,YAAM,UAAU,MAAM,KAAK,UAAU;AACrC,UAAI,KAAK,UAAU,SAAS,MAAM,GAAG;AACjC,eAAO;AAAA,MACX;AAEA,YAAM,WAAW;AAAA,YAAe,MAAM;AAAA;AACtC,YAAM,WAAAC,QAAG,SAAS,WAAW,KAAK,WAAW,QAAQ;AACrD,aAAO;AAAA,IACX,SAAS,OAAO;AACZ,aAAO;AAAA,IACX;AAAA,EACJ;AAAA;AAAA;AAAA;AAAA,EAKA,MAAM,aAAa,QAAkC;AACjD,QAAI;AACA,UAAI,UAAU,MAAM,KAAK,UAAU;AACnC,UAAI,CAAC,KAAK,UAAU,SAAS,MAAM,GAAG;AAClC,eAAO;AAAA,MACX;AAGA,YAAM,QAAQ,IAAI,OAAO,MAAM,MAAM,sBAAsB,IAAI;AAC/D,gBAAU,QAAQ,QAAQ,OAAO,EAAE;AAGnC,gBAAU,QAAQ,QAAQ,YAAY,IAAI;AAE1C,YAAM,WAAAA,QAAG,SAAS,UAAU,KAAK,WAAW,QAAQ,KAAK,IAAI,IAAI;AACjE,aAAO;AAAA,IACX,SAAS,OAAO;AACZ,aAAO;AAAA,IACX;AAAA,EACJ;AAAA;AAAA;AAAA;AAAA,EAKA,MAAM,mBAAqC;AACvC,QAAI;AACA,YAAM,WAAAA,QAAG,SAAS,OAAO,KAAK,WAAW,WAAAA,QAAG,UAAU,IAAI;AAC1D,aAAO;AAAA,IACX,QAAQ;AACJ,aAAO;AAAA,IACX;AAAA,EACJ;AAAA,EAEA,MAAc,YAA6B;AACvC,WAAO,WAAAA,QAAG,SAAS,SAAS,KAAK,WAAW,MAAM;AAAA,EACtD;AAAA,EAEQ,UAAU,SAAiB,QAAyB;AACxD,WAAO,QAAQ,SAAS,MAAM,KAAK,QAAQ,SAAS,eAAe;AAAA,EACvE;AACJ;;;AD9DO,IAAM,iBAAN,MAAqB;AAAA,EAClB;AAAA,EACA;AAAA,EACA;AAAA,EAER,cAAc;AACZ,SAAK,YAAY,aAAAC,QAAK,KAAK,WAAAC,QAAG,QAAQ,GAAG,OAAO;AAChD,SAAK,aAAa,aAAAD,QAAK,KAAK,KAAK,WAAW,iBAAiB;AAC7D,SAAK,eAAe,IAAI,aAAa;AAErC,QAAI,CAAC,WAAAE,QAAG,WAAW,KAAK,SAAS,GAAG;AAClC,iBAAAA,QAAG,UAAU,KAAK,WAAW,EAAE,WAAW,KAAK,CAAC;AAAA,IAClD;AAAA,EACF;AAAA,EAEA,MAAM,mBAAqC;AAGzC,WAAO,MAAM,KAAK,aAAa,iBAAiB;AAAA,EAClD;AAAA,EAEA,kBAA0B;AACxB,UAAM,WAAW,WAAAD,QAAG,SAAS;AAC7B,YAAQ,UAAU;AAAA,MAChB,KAAK;AAAU,eAAO;AAAA,MACtB,KAAK;AAAS,eAAO;AAAA,MACrB,KAAK;AAAS,eAAO;AAAA,MACrB;AAAS,eAAO;AAAA,IAClB;AAAA,EACF;AAAA,EAEA,gBAAgB,UAA2B;AAOzC,QAAI;AACF,iBAAAC,QAAG,WAAW,KAAK,aAAa,WAAW,GAAG,WAAAA,QAAG,UAAU,IAAI;AAC/D,aAAO;AAAA,IACT,QAAQ;AACN,aAAO;AAAA,IACT;AAAA,EACF;AAAA,EAEA,MAAM,2BAA6C;AACjD,UAAM,SAAS,MAAM,eAAe,YAAY,EAAE,QAAQ;AAC1D,WAAO,OAAO;AAAA,EAChB;AAAA,EAEA,MAAM,mBAAqC;AAKzC,UAAM,YAAY,MAAM,KAAK,aAAa,iBAAiB;AAC3D,QAAI,WAAW;AACb,aAAO;AAAA,IACT;AACA,WAAO;AAAA,EACT;AAAA,EAEA,yBAA+B;AAC7B,YAAQ,IAAI,wBAAiB;AAC7B,YAAQ,IAAI,kBAAkB;AAC9B,YAAQ,IAAI,sCAAsC;AAClD,QAAI,WAAAD,QAAG,SAAS,MAAM,SAAS;AAC7B,cAAQ,IAAI,4CAA4C;AAAA,IAC1D,OAAO;AACL,cAAQ,IAAI,YAAY;AAAA,IAC1B;AACA,YAAQ,IAAI,mDAAmD;AAAA,EACjE;AAAA,EAEA,MAAM,mBAAmB,QAAkC;AACzD,YAAQ,IAAI,iCAA4B,MAAM,KAAK;AAGnD,UAAM,iBAAiB,MAAM,KAAK,aAAa,iBAAiB;AAChE,QAAI,gBAAgB;AAClB,YAAM,UAAU,MAAM,KAAK,aAAa,UAAU,MAAM;AACxD,UAAI,SAAS;AACX,gBAAQ,IAAI,mBAAc,MAAM,iBAAiB;AACjD,eAAO;AAAA,MACT;AAAA,IACF,OAAO;AAEL,cAAQ,IAAI,yEAA+D;AAAA,IAC7E;AAMA,QAAI,CAAC,gBAAgB;AACnB,cAAQ,IAAI,sDAAiD;AAC7D,cAAQ,IAAI,gEAAyD;AACrE,cAAQ,IAAI,mBAAmB,MAAM,gBAAgB;AAAA,IACvD;AAEA,WAAO;AAAA,EACT;AAAA,EAEA,MAAM,QAAQ,QAAgC;AAC5C,QAAI,QAAQ;AACV,YAAM,KAAK,aAAa,aAAa,MAAM;AAAA,IAC7C;AAAA,EAGF;AAAA;AAGF;;;AH9HA;AAcA,eAAe,oCAAoC,MAAc,cAA+C;AAC9G,QAAM,aAAa,IAAI,eAAe;AACtC,QAAM,eAAe,MAAM,WAAW,iBAAiB;AAEvD,MAAI,CAAC,cAAc;AACjB,YAAQ,IAAI;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,CAcf;AAEG,UAAM,WAAW,MAAM,OAAO,UAAU;AACxC,UAAM,KAAK,SAAS,gBAAgB;AAAA,MAClC,OAAO,QAAQ;AAAA,MACf,QAAQ,QAAQ;AAAA,IAClB,CAAC;AAED,WAAO,IAAI,QAAQ,CAAC,YAAY;AAC9B,SAAG,SAAS,yCAAyC,OAAO,WAAW;AACrE,WAAG,MAAM;AAET,YAAI,OAAO,YAAY,MAAM,OAAO,OAAO,YAAY,MAAM,OAAO;AAClE,kBAAQ,IAAI,gDAAyC;AAErD,gBAAM,WAAW,WAAW,gBAAgB;AAC5C,gBAAM,kBAAkB,WAAW,gBAAgB,WAAAE,QAAG,SAAS,CAAC;AAEhE,cAAI,iBAAiB;AACnB,oBAAQ,IAAI,iBAAO,QAAQ,gDAAgD;AAC3E,oBAAQ,IAAI,EAAE;AACd,oBAAQ,IAAI,6BAAsB;AAClC,oBAAQ,IAAI,gEAAgE;AAC5E,oBAAQ,IAAI,qCAAqC;AACjD,oBAAQ,IAAI,+CAA+C;AAC3D,oBAAQ,IAAI,uDAAuD;AACnE,oBAAQ,IAAI,EAAE;AACd,oBAAQ,IAAI,2CAAoC,IAAI;AACpD,oBAAQ,IAAI,EAAE;AACd,oBAAQ,IAAI;AACZ;AAAA,UACF;AAEA,gBAAM,UAAU,MAAM,WAAW,iBAAiB;AAElD,cAAI,SAAS;AACX,oBAAQ,IAAI,wCAAmC;AAC/C,oBAAQ,IAAI,sDAAsD;AAClE,oBAAQ,IAAI,EAAE;AAGd,kBAAM,cAAc,gBAAgB,eAAe;AACnD,kBAAM,SAAS,GAAG,WAAW;AAE7B,oBAAQ,IAAI,oCAA6B,MAAM,EAAE;AACjD,oBAAQ,IAAI,qDAAqD;AACjE,oBAAQ,IAAI,EAAE;AACd,oBAAQ,IAAI,4BAAqB;AACjC,oBAAQ,IAAI,gBAAgB,MAAM,EAAE;AACpC,oBAAQ,IAAI,EAAE;AAEd,oBAAQ,MAAM;AAAA,UAChB,OAAO;AACL,oBAAQ,IAAI,0BAAqB;AACjC,oBAAQ,IAAI,EAAE;AACd,oBAAQ,IAAI,+BAAwB;AACpC,oBAAQ,IAAI,sCAAsC;AAClD,oBAAQ,IAAI,0CAA0C;AACtD,oBAAQ,IAAI,6CAA6C;AACzD,oBAAQ,IAAI,qDAAqD;AACjE,oBAAQ,IAAI,EAAE;AACd,oBAAQ,IAAI,0DAAmD;AAC/D,oBAAQ,IAAI,EAAE;AACd,oBAAQ,IAAI;AAAA,UACd;AAAA,QACF,OAAO;AACL,kBAAQ,IAAI,0CAAgC;AAC5C,kBAAQ,IAAI,wCAAwC;AACpD,kBAAQ,IAAI,sDAAsD;AAClE,kBAAQ,IAAI,EAAE;AACd,kBAAQ,IAAI;AAAA,QACd;AAAA,MACF,CAAC;AAAA,IACH,CAAC;AAAA,EACH,OAAO;AAEL,UAAM,cAAc,gBAAgB,eAAe;AACnD,WAAO,GAAG,WAAW;AAAA,EACvB;AACF;AAEA,SAAS,iBAAyB;AAChC,MAAI;AAEF,UAAM,UAAU,aAAAC,QAAK,KAAK,QAAQ,IAAI,GAAG,cAAc;AACvD,QAAI,WAAAC,QAAG,WAAW,OAAO,GAAG;AAC1B,YAAM,MAAM,KAAK,MAAM,WAAAA,QAAG,aAAa,SAAS,MAAM,CAAC;AACvD,UAAI,IAAI,MAAM;AAEZ,eAAO,IAAI,KAAK,QAAQ,iBAAiB,EAAE,EAAE,YAAY;AAAA,MAC3D;AAAA,IACF;AAAA,EACF,QAAQ;AAAA,EAAE;AAGV,SAAO,QAAQ,KAAK,IAAI,EAAE,SAAS,EAAE,CAAC;AACxC;AAEA,eAAe,kBAAkB,QAAkC;AACjE,SAAO,IAAI,QAAQ,CAAC,YAAY;AAC9B,UAAM,EAAE,OAAAC,OAAM,IAAI,QAAQ,eAAe;AACzC,UAAM,WAAWA,OAAM,YAAY,CAAC,MAAM,GAAG,EAAE,SAAS,IAAK,CAAC;AAE9D,QAAI,SAAS;AACb,aAAS,OAAO,GAAG,QAAQ,CAAC,SAAiB;AAC3C,gBAAU,KAAK,SAAS;AAAA,IAC1B,CAAC;AAED,aAAS,GAAG,SAAS,CAAC,SAAiB;AACrC,cAAQ,SAAS,KAAK,OAAO,SAAS,UAAU,CAAC;AAAA,IACnD,CAAC;AAED,aAAS,GAAG,SAAS,MAAM,QAAQ,KAAK,CAAC;AAAA,EAC3C,CAAC;AACH;AAsBA,eAAe,mBAAmB,MAAc,SAAc,QAAqC;AACjG,MAAI;AAEF,UAAM,EAAE,eAAAC,eAAc,IAAI,MAAM;AAEhC,UAAM,cAAc,OAAO;AAC3B,UAAM,SAAS,IAAIA,eAAc;AAAA,MAC/B,WAAW;AAAA,MACX,WAAW;AAAA,MACX,cAAc;AAAA;AAAA,MACd,cAAc,QAAQ;AAAA,MACtB,eAAe,QAAQ;AAAA,IACzB,CAAC;AAGD,WAAO,iBAAiB;AAGxB,UAAM,aAAa,MAAM,OAAO,YAAY;AAE5C,YAAQ,IAAI,kCAA2B;AACvC,YAAQ,IAAI,iBAAiB,UAAU,EAAE;AACzC,YAAQ,IAAI,oCAAoC,IAAI,EAAE;AACtD,YAAQ,IAAI,8CAA8C;AAC1D,YAAQ,IAAI,EAAE;AACd,YAAQ,IAAI,gDAAyC;AACrD,YAAQ,IAAI,MAAM,UAAU,EAAE;AAC9B,YAAQ,IAAI,EAAE;AACd,YAAQ,IAAI,6EAAsE;AAGlF,UAAM,UAAU,MAAM;AACpB,cAAQ,IAAI,6CAAsC;AAClD,aAAO,KAAK;AAAA,IACd;AAEA,YAAQ,GAAG,UAAU,OAAO;AAC5B,YAAQ,GAAG,WAAW,OAAO;AAAA,EAE/B,SAAS,OAAO;AACd,YAAQ,MAAM,0CAAqC,iBAAiB,QAAQ,MAAM,UAAU,OAAO,KAAK,CAAC;AACzG,YAAQ,IAAI,+EAAwE;AAAA,EACtF;AACF;AAEA,IAAM,aAAa,aAAAC,QAAK,KAAK,WAAAC,QAAG,QAAQ,GAAG,OAAO;AAClD,IAAM,cAAc,aAAAD,QAAK,KAAK,YAAY,kBAAkB;AAO5D,IAAM,YAA2F;AAAA,EAC/F,MAAM;AAAA,IACJ,SAAS;AAAA,IACT,SAAS;AAAA,IACT,aAAa;AAAA,EACf;AAAA,EACA,UAAU;AAAA,IACR,SAAS;AAAA,IACT,SAAS;AAAA,IACT,aAAa;AAAA,EACf;AAAA,EACA,SAAS;AAAA,IACP,SAAS;AAAA,IACT,SAAS;AAAA,IACT,aAAa;AAAA,EACf;AACF;AAKA,SAAS,aAAa,MAA0B;AAC9C,QAAM,aAA2B,CAAC,QAAQ,YAAY,SAAS;AAC/D,MAAI,CAAC,WAAW,SAAS,IAAkB,GAAG;AAC5C,YAAQ,MAAM,wBAAmB,IAAI,EAAE;AACvC,YAAQ,KAAK,CAAC;AAAA,EAChB;AACA,SAAO;AACT;AAEA,IAAM,gBAAgB,IAAI,cAAc;AAExC,eAAe,kBAAkB,MAAc,SAA6B;AAC1E,QAAM,OAAmB,QAAQ,OAAO,aAAa,QAAQ,IAAI,IAAI;AAErE,QAAM,gBAA+B;AAAA,IACnC,YAAY;AAAA,IACZ,QAAQ,QAAQ;AAAA,IAChB;AAAA,IACA,SAAS,QAAQ;AAAA,IACjB,SAAS,QAAQ;AAAA,IACjB,OAAO,QAAQ;AAAA,IACf,WAAW,QAAQ;AAAA,IACnB,SAAS,QAAQ;AAAA,IACjB,OAAO,QAAQ,UAAU;AAAA,IACzB,WAAW,QAAQ;AAAA,IACnB,UAAU,QAAQ;AAAA,IAClB,WAAW,QAAQ;AAAA,IACnB,kBAAkB,QAAQ;AAAA,IAC1B,YAAY,QAAQ;AAAA,EACtB;AAEA,UAAQ,IAAI,qCAA8B;AAC1C,UAAQ,IAAI,YAAY,IAAI,KAAK,UAAU,IAAI,EAAE,WAAW,GAAG;AAE/D,MAAI;AACF,UAAM,SAAS,MAAM,cAAc,MAAM,aAAa;AAGtD,QAAI,CAAC,QAAQ,iBAAiB,CAAC,QAAQ,QAAQ;AAC7C,YAAM,mBAAmB,MAAM,oCAAoC,IAAI;AACvE,UAAI,kBAAkB;AAEpB,gBAAQ,IAAI,qCAA8B,gBAAgB,EAAE;AAAA,MAG9D;AAAA,IACF,WAAW,QAAQ,UAAU,QAAQ,OAAO,SAAS,OAAO,GAAG;AAE7D,YAAM,aAAa,IAAI,eAAe;AACtC,YAAM,WAAW,mBAAmB,QAAQ,MAAM;AAAA,IACpD;AAGA,QAAI,QAAQ,eAAe;AACzB,cAAQ,IAAI,wCAAiC;AAC7C,YAAM,mBAAmB,MAAM,SAAS,MAAM;AAAA,IAChD;AAGA,WAAO,QAAQ,KAAK,QAAQ,MAAM;AAClC,WAAO,QAAQ,KAAK,QAAQ,MAAM;AAGlC,UAAM,IAAI,QAAQ,aAAW,WAAW,SAAS,GAAI,CAAC;AAGtD,UAAM,UAAU,MAAM;AACpB,cAAQ,IAAI,8BAAuB;AACnC,oBAAc,KAAK;AACnB,cAAQ,KAAK,CAAC;AAAA,IAChB;AAEA,YAAQ,GAAG,UAAU,OAAO;AAC5B,YAAQ,GAAG,WAAW,OAAO;AAG7B,WAAO,GAAG,SAAS,CAAC,SAAS;AAC3B,UAAI,SAAS,GAAG;AACd,gBAAQ,MAAM,yCAAoC,IAAI,EAAE;AACxD,gBAAQ,KAAK,QAAQ,CAAC;AAAA,MACxB;AAAA,IACF,CAAC;AAAA,EAEH,SAAS,OAAY;AACnB,YAAQ,MAAM,kCAA6B,iBAAiB,QAAQ,MAAM,UAAU,OAAO,KAAK,CAAC;AACjG,YAAQ,KAAK,CAAC;AAAA,EAChB;AACF;AAEA,IAAM,UAAU,IAAI,yBAAQ;AAE5B,QACG,KAAK,MAAM,EACX,YAAY,+CAA+C,EAC3D,QAAQ,QAAQ;AAGnB,QACG,QAAQ,QAAQ,EAChB,YAAY,yCAAyC,EACrD,SAAS,UAAU,wBAAwB,CAAC,MAAM,SAAS,GAAG,EAAE,CAAC,EACjE,OAAO,uBAAuB,oDAAoD,QAAQ,KAAK,IAAI,CAAC,QAAQ,EAC5G,OAAO,qBAAqB,2CAA2C,UAAU,EACjF,OAAO,qBAAqB,mBAAmB,MAAM,EACrD,OAAO,qBAAqB,oBAAoB,MAAM,EACtD,OAAO,WAAW,2CAA2C,EAC7D,OAAO,uBAAuB,wCAAwC,EACtE,OAAO,iBAAiB,wBAAwB,EAChD,OAAO,cAAc,0BAA0B,EAC/C,OAAO,qBAAqB,oBAAoB,KAAK,EACrD,OAAO,yBAAyB,wBAAwB,KAAK,EAC7D,OAAO,4BAA4B,uDAAuD,EAC1F,OAAO,+BAA+B,kCAAkC,GAAG,EAC3E,OAAO,iBAAiB,6BAA6B,EACrD,OAAO,oBAAoB,oDAAoD,EAC/E,OAAO,6BAA6B,qCAAqC,EACzE,OAAO,8BAA8B,2DAA2D,aAAa,EAC7G,MAAM,OAAO,EACb,OAAO,OAAO,MAAc,YAAY;AACvC,QAAM,kBAAkB,MAAM,OAAO;AACvC,CAAC;AAGH,IAAM,aAAa,QAAQ,QAAQ,KAAK,EAAE,YAAY,mCAAmC;AAEzF,WACG,QAAQ,OAAO,EACf,YAAY,8CAA8C,EAC1D,OAAO,YAAY;AAClB,QAAM,aAAa,IAAI,eAAe;AACtC,QAAM,WAAW,iBAAiB;AAClC,UAAQ,IAAI,8BAAyB;AACvC,CAAC;AAEH,WACG,QAAQ,QAAQ,EAChB,YAAY,gCAAgC,EAC5C,OAAO,YAAY;AAClB,QAAM,aAAa,IAAI,eAAe;AACtC,QAAM,aAAa,MAAM,WAAW,iBAAiB;AACrD,UAAQ,IAAI;AAAA,cAAiB,aAAa,sBAAiB,uBAAkB,EAAE;AAC/E,MAAI,CAAC,WAAY,SAAQ,IAAI,8BAA8B;AAC7D,CAAC;AAEH,WACG,QAAQ,eAAe,EACvB,YAAY,wBAAwB,EACpC,OAAO,OAAO,WAAW;AACxB,QAAM,SAAS,MAAM,kBAAkB,MAAM;AAC7C,UAAQ,IAAI,oBAAoB,SAAS,kBAAa,eAAU,EAAE;AACpE,CAAC;AAGH,eAAe,kBAAkB,MAA6B;AAC5D,UAAQ,IAAI,yCAAkC;AAC9C,UAAQ,IAAI,yBAAyB;AACrC,UAAQ,IAAI,qEAAqE;AACjF,UAAQ,IAAI,sEAA4D;AACxE,UAAQ,IAAI,EAAE;AAEd,QAAM,EAAE,iBAAAE,iBAAgB,IAAI,MAAM;AAClC,QAAM,EAAE,YAAAC,YAAW,IAAI,MAAM;AAE7B,QAAM,WAAW,IAAID,iBAAgB;AACrC,QAAM,aAAa,IAAIC,YAAW;AAElC,UAAQ,IAAI,oCAA6B;AACzC,QAAM,WAAW,MAAM,SAAS,YAAY;AAE5C,MAAI,CAAC,UAAU;AACb,YAAQ,MAAM,yEAAoE;AAClF,YAAQ,KAAK,CAAC;AAAA,EAChB;AACA,UAAQ,IAAI,iBAAiB,QAAQ,EAAE;AAEvC,UAAQ,IAAI,yCAAkC;AAE9C,QAAM,EAAE,MAAM,WAAW,QAAQ,YAAY,SAAS,UAAU,IAAI,MAAM,WAAW,MAAM,MAAM,GAAG,QAAQ;AAE5G,UAAQ,IAAI,kCAA2B;AAGvC,MAAI,aAAa;AACjB,MAAI,SAAS,MAAM,SAAS,QAAQ,YAAY,SAAS;AAEzD,MAAI,CAAC,QAAQ;AACX,YAAQ,IAAI,2BAAiB,OAAO,iCAAiC;AACrE,YAAQ,IAAI,2CAAoC;AAChD,iBAAa,KAAK,MAAM,KAAK,OAAO,KAAK,QAAQ,MAAQ,KAAK,GAAK;AACnE,aAAS,MAAM,SAAS,QAAQ,YAAY,SAAS;AAAA,EACvD;AAEA,MAAI,CAAC,QAAQ;AACX,YAAQ,MAAM,kCAA6B;AAC3C,YAAQ,MAAM,oDAA+C;AAC7D,YAAQ,MAAM,qDAAgD,IAAI;AAClE,YAAQ,KAAK,CAAC;AAAA,EAChB;AAEA,UAAQ,IAAI,EAAE;AACd,UAAQ,IAAI,mBAAY;AAExB,UAAQ,IAAI,mBAAmB,UAAU,IAAI,UAAU,EAAE;AAEzD,MAAI,WAAW;AACb,YAAQ,IAAI,6DAAiD;AAAA,EAC/D,OAAO;AACL,YAAQ,IAAI,0DAA0D;AAAA,EACxE;AAEA,UAAQ,IAAI,EAAE;AACd,UAAQ,IAAI,yDAAkD;AAC9D,UAAQ,IAAI,8FAAoF;AAGhG,QAAM,UAAU,YAAY;AAC1B,YAAQ,IAAI,sCAA+B;AAC3C,UAAM,SAAS,QAAQ;AACvB,eAAW,KAAK;AAChB,YAAQ,KAAK,CAAC;AAAA,EAChB;AAEA,UAAQ,GAAG,UAAU,OAAO;AAC5B,UAAQ,GAAG,WAAW,OAAO;AAG7B,cAAY,MAAM;AAAA,EAAE,GAAG,GAAK;AAC9B;AAKA,QACG,SAAS,UAAU,sBAAsB,EACzC,mBAAmB,IAAI,EACvB,OAAO,OAAO,SAAS,YAAY,YAAY;AAG9C,MAAI,CAAC,SAAS;AAEZ,QAAI,QAAQ,KAAK,SAAS,GAAG;AAC3B,cAAQ,KAAK;AACb;AAAA,IACF;AAAA,EACF;AAEA,QAAM,OAAO,SAAS,SAAS,EAAE;AACjC,MAAI,MAAM,IAAI,GAAG;AACf,YAAQ,MAAM,wCAAmC;AACjD,YAAQ,KAAK,CAAC;AAAA,EAChB;AAGA,QAAM,UAAU,QAAQ,KAAK,MAAM,CAAC;AACpC,QAAM,mBACJ,QAAQ,SAAS,UAAU,KAC3B,QAAQ,SAAS,IAAI,KACrB,QAAQ,SAAS,kBAAkB,KACnC,QAAQ,SAAS,OAAO;AAE1B,MAAI,kBAAkB;AACpB,YAAQ,IAAI,sEAA4D;AACxE,YAAQ,IAAI,oFAA0E;AACtF,YAAQ,IAAI,wCAAwC;AACpD,UAAM,kBAAkB,MAAM,QAAQ,KAAK,CAAC;AAAA,EAC9C,OAAO;AACL,UAAM,kBAAkB,IAAI;AAAA,EAC9B;AACF,CAAC;AAQI,IAAM,aAA0B;AAAA,EACrC;AAAA,IACE,MAAM;AAAA,IACN,SAAS;AAAA,IACT,aAAa;AAAA,IACb,MAAM,CAAC,QAAQ,IAAI,cAAc,QAAQ,IAAI,iBAAiB;AAAA,EAChE;AAAA,EACA;AAAA,IACE,MAAM;AAAA;AAAA,IACN,SAAS;AAAA,IACT,aAAa;AAAA,IACb,MAAM,CAAC,QAAQ,IAAI,cAAc,QAAQ,IAAI,iBAAiB;AAAA,EAChE;AAAA,EACA;AAAA,IACE,MAAM;AAAA,IACN,SAAS;AAAA,IACT,aAAa;AAAA;AAAA,IACb,MAAM,CAAC,QAAQ,IAAI,cAAc,SAAS,IAAI,iBAAiB;AAAA,EACjE;AAAA,EACA;AAAA,IACE,MAAM;AAAA,IACN,SAAS;AAAA,IACT,aAAa;AAAA,IACb,MAAM,CAAC,QAAQ,IAAI,eAAe,kBAAkB,KAAK,IAAI,kBAAkB,kBAAkB;AAAA,EACnG;AAAA,EACA;AAAA,IACE,MAAM;AAAA,IACN,SAAS;AAAA,IACT,aAAa;AAAA,IACb,MAAM,CAAC,QAAQ,IAAI,cAAc,QAAQ,IAAI,iBAAiB;AAAA,EAChE;AAAA,EACA;AAAA,IACE,MAAM;AAAA,IACN,SAAS;AAAA,IACT,aAAa;AAAA,IACb,MAAM,CAAC,QAAQ,IAAI,kBAAkB,eAAe;AAAA,EACtD;AAAA,EACA;AAAA,IACE,MAAM;AAAA,IACN,SAAS;AAAA,IACT,aAAa;AAAA,IACb,MAAM,CAAC,QAAQ,IAAI,eAAe,eAAe,KAAK,IAAI,kBAAkB,cAAc;AAAA,EAC5F;AAAA,EACA;AAAA,IACE,MAAM;AAAA,IACN,SAAS;AAAA,IACT,aAAa;AAAA,IACb,MAAM,CAAC,QAAQ,IAAI,eAAe,cAAc;AAAA,EAClD;AAAA,EACA;AAAA,IACE,MAAM;AAAA,IACN,SAAS;AAAA,IACT,aAAa;AAAA,IACb,MAAM,CAAC,QAAQ,IAAI,cAAc;AAAA,EACnC;AAAA,EACA;AAAA,IACE,MAAM;AAAA,IACN,SAAS;AAAA,IACT,aAAa;AAAA,IACb,MAAM,CAAC,QAAQ,IAAI,eAAe,aAAa,KAAK,IAAI,kBAAkB,aAAa;AAAA,EACzF;AAAA,EACA;AAAA,IACE,MAAM;AAAA,IACN,SAAS;AAAA,IACT,aAAa;AAAA,IACb,MAAM,CAAC,QAAQ,IAAI,cAAc,UAAU,IAAI,iBAAiB;AAAA,EAClE;AACF;AAEO,SAAS,gBAAgB,KAA6B;AAC3D,MAAI;AACF,QAAI,CAAC,KAAK;AACR,YAAM,UAAU,aAAAH,QAAK,KAAK,QAAQ,IAAI,GAAG,cAAc;AACvD,UAAI,CAAC,WAAAI,QAAG,WAAW,OAAO,EAAG,QAAO;AACpC,YAAM,KAAK,MAAM,WAAAA,QAAG,aAAa,SAAS,MAAM,CAAC;AAAA,IACnD;AACA,WAAO,WAAW,KAAK,OAAK,EAAE,KAAK,GAAG,CAAC,KAAK;AAAA,EAC9C,QAAQ;AACN,WAAO;AAAA,EACT;AACF;AAEA,eAAe,YAAY,MAAc,UAAU,IAAsB;AACvE,WAAS,IAAI,GAAG,IAAI,SAAS,KAAK;AAChC,QAAI;AACF,YAAM,IAAI,QAAc,CAAC,SAAS,WAAW;AAC3C,cAAM,MAAM,aAAAC,QAAK,QAAQ;AAAA,UACvB;AAAA,UACA,QAAQ;AAAA,UACR,SAAS;AAAA,QACX,GAAG,CAAC,QAAQ;AACV,kBAAQ;AAAA,QACV,CAAC;AACD,YAAI,GAAG,SAAS,MAAM;AACtB,YAAI,IAAI;AAAA,MACV,CAAC;AACD,aAAO;AAAA,IACT,QAAQ;AACN,YAAM,IAAI,QAAQ,OAAK,WAAW,GAAG,GAAI,CAAC;AAAA,IAC5C;AAAA,EACF;AACA,SAAO;AACT;AAEA,QACG,QAAQ,KAAK,EACb,YAAY,uDAAuD,EACnE,OAAO,qBAAqB,2CAA2C,EACvE,OAAO,2BAA2B,oBAAoB,EACtD,OAAO,uBAAuB,oBAAoB,EAClD,OAAO,qBAAqB,2CAA2C,UAAU,EACjF,OAAO,OAAO,YAAY;AAIzB,UAAQ,IAAI,EAAE;AACd,UAAQ,IAAI,gDAAyC;AACrD,UAAQ,IAAI,EAAE;AAEd,QAAM,EAAE,iBAAAH,iBAAgB,IAAI,MAAM;AAClC,QAAM,EAAE,YAAAC,YAAW,IAAI,MAAM;AAE7B,QAAM,WAAW,IAAID,iBAAgB;AACrC,QAAM,aAAa,IAAIC,YAAW;AAGlC,QAAM,WAAW,MAAM,SAAS,YAAY;AAC5C,MAAI,CAAC,UAAU;AACb,YAAQ,MAAM,sEAAiE;AAC/E,YAAQ,KAAK,CAAC;AAAA,EAChB;AAGA,QAAM,YAAY,gBAAgB;AAClC,MAAI,OAAO,QAAQ;AACnB,MAAI,UAAU,QAAQ;AAEtB,MAAI,WAAW;AACb,QAAI,CAAC,KAAM,QAAO,UAAU;AAC5B,QAAI,CAAC,QAAS,WAAU,UAAU;AAAA,EACpC,OAAO;AACL,QAAI,CAAC,QAAQ,CAAC,SAAS;AACrB,cAAQ,IAAI,gDAAsC;AAClD,UAAI,CAAC,SAAS;AACZ,gBAAQ,MAAM,0EAAqE;AACnF,gBAAQ,KAAK,CAAC;AAAA,MAChB;AACA,UAAI,CAAC,MAAM;AACT,gBAAQ,MAAM,oEAA+D;AAC7E,gBAAQ,KAAK,CAAC;AAAA,MAChB;AAAA,IACF;AAAA,EACF;AAGA,UAAQ,IAAI,6DAA6D;AACzE,QAAM,EAAE,MAAM,WAAW,QAAQ,YAAY,SAAS,UAAU,IAAI,MAAM,WAAW,MAAM,MAAM,GAAG,QAAQ;AAG5G,MAAI,aAAa;AACjB,MAAI,SAAS,MAAM,SAAS,QAAQ,YAAY,SAAS;AACzD,MAAI,CAAC,QAAQ;AACX,iBAAa,KAAK,MAAM,KAAK,OAAO,KAAK,QAAQ,MAAQ,KAAK,GAAK;AACnE,aAAS,MAAM,SAAS,QAAQ,YAAY,SAAS;AAAA,EACvD;AAEA,MAAI,CAAC,QAAQ;AACX,YAAQ,MAAM,yDAAoD;AAClE,YAAQ,KAAK,CAAC;AAAA,EAChB;AAEA,QAAM,UAAU,WAAW,UAAU,IAAI,UAAU;AAEnD,UAAQ,IAAI,mCAA8B;AAC1C,UAAQ,IAAI,EAAE;AAKd,QAAM,CAAC,KAAK,GAAG,IAAI,IAAI,QAAQ,MAAM,GAAG;AAExC,QAAM,YAAQ,6BAAM,KAAK,MAAM;AAAA,IAC7B,OAAO,CAAC,WAAW,QAAQ,MAAM;AAAA;AAAA,IACjC,OAAO;AAAA,IACP,KAAK;AAAA,MACH,GAAG,QAAQ;AAAA,MACX,MAAM,KAAK,SAAS;AAAA,MACpB,UAAU;AAAA,MACV,SAAS;AAAA,MACT,kBAAkB;AAAA;AAAA,IACpB;AAAA,EACF,CAAC;AAGD,MAAI,cAAc;AAGlB,QAAM,QAAQ,GAAG,QAAQ,CAAC,SAAiB;AACzC,QAAI,OAAO,KAAK,SAAS;AAGzB,QAAI,KAAK,SAAS,SAAS,KAAK,KAAK,SAAS,SAAS,KAAK,KAAK,SAAS,cAAc,KAAK,KAAK,SAAS,mBAAmB,GAAG;AAC/H;AAAA,IACF;AAGA,QAAI,CAAC,eAAe,KAAK,SAAS,UAAU,GAAG;AAC7C,cAAQ,OAAO,MAAM,IAAI;AAEzB,YAAM,cAAc,YAAY,cAAO;AACvC,cAAQ,OAAO,MAAM,uBAAuB,OAAO,IAAI,WAAW;AAAA,CAAI;AACtE,oBAAc;AACd;AAAA,IACF;AAEA,YAAQ,OAAO,MAAM,IAAI;AAAA,EAC3B,CAAC;AAGD,QAAM,QAAQ,GAAG,QAAQ,CAAC,SAAiB;AACzC,QAAI,OAAO,KAAK,SAAS;AAGzB,QAAI,KAAK,SAAS,SAAS,KAAK,KAAK,SAAS,SAAS,KAAK,KAAK,SAAS,cAAc,KAAK,KAAK,SAAS,mBAAmB,KAAK,KAAK,SAAS,eAAe,GAAG;AACjK;AAAA,IACF;AAEA,YAAQ,OAAO,MAAM,IAAI;AAAA,EAC3B,CAAC;AAGD,QAAM,QAAQ,MAAM,YAAY,IAAI;AAEpC,MAAI,CAAC,OAAO;AACV,YAAQ,MAAM,mCAA8B,IAAI,8BAA8B;AAC9E,UAAM,KAAK;AACX,eAAW,KAAK;AAChB,UAAM,SAAS,QAAQ;AACvB,YAAQ,KAAK,CAAC;AAAA,EAChB;AAKA,QAAM,GAAG,QAAQ,MAAM;AACrB,YAAQ,IAAI,sBAAsB;AAClC,eAAW,KAAK;AAChB,aAAS,QAAQ;AACjB,YAAQ,KAAK,CAAC;AAAA,EAChB,CAAC;AAED,QAAM,UAAU,YAAY;AAC1B,YAAQ,IAAI,8BAAuB;AACnC,UAAM,KAAK;AACX,UAAM,SAAS,QAAQ;AACvB,eAAW,KAAK;AAChB,YAAQ,KAAK,CAAC;AAAA,EAChB;AAEA,UAAQ,GAAG,UAAU,OAAO;AAC5B,UAAQ,GAAG,WAAW,OAAO;AAC/B,CAAC;AAGH,IAAM,cACJ,OAAO,QAAQ,KAAK,CAAC,MAAM;AAAA,CAGzB,YAAY,QAAQ,UAAU,aAAAH,QAAK,QAAQ,QAAQ,KAAK,CAAC,CAAC,CAAC;AAE3D,QAAQ,KAAK,CAAC,EAAE,SAAS,SAAS;AAElC,QAAQ,KAAK,CAAC,EAAE,SAAS,OAAO,KAChC,QAAQ,KAAK,CAAC,EAAE,SAAS,QAAQ;AAGrC,IAAI,aAAa;AACf,UAAQ,MAAM;AAChB;","names":["import_child_process","express","http","NatAPI","import_https","import_http","import_os","httpProxy","http","os","selfsigned","https","import_child_process","import_fs","import_os","import_path","import_http","import_child_process","import_https","https","util","dgram","path","fs","os","https","import_os","import_fs","import_path","import_fs","import_path","path","fs","path","os","fs","os","path","fs","spawn","WebhookBridge","path","os","InternetManager","HttpsProxy","fs","http"]}