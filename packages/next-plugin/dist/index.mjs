import{TunnelManager as c}from"@byronwade/beam";function p(n={},t={}){return{...n,webpack:(o,e)=>{if(e.dev&&e.isServer){let{enabled:a=!0,silent:s=!1,port:r=3e3}=t;a&&!process.env.BEAM_INITIALIZED&&(process.env.BEAM_INITIALIZED="true",l(r,s))}return typeof n.webpack=="function"?n.webpack(o,e):o}}}async function l(n,t){let o=new c;try{t||console.log("  \u279C  Beam:    Initializing tunnel..."),(await o.start({targetPort:n,mode:"balanced"})).stdout?.on("data",s=>{let r=s.toString();(r.includes("onion")||r.includes(".local"))&&!t&&r.split(`
`).filter(i=>i.trim()!=="").forEach(i=>{console.log(`  \u279C  Beam:    ${i.trim()}`)})});let a=()=>{o.stop()};process.on("SIGINT",a),process.on("SIGTERM",a),process.on("exit",a)}catch(e){t||console.error("  \u279C  Beam:    Failed to start tunnel:",e.message)}}export{p as withBeam};
